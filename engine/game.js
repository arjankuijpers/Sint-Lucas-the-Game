// JavaScript Document

//game

function start(){stage=new Kinetic.Stage({container:"container",width:950,height:500});backgroundLayer=new Kinetic.Layer;characterLayer=new Kinetic.Layer;hudLayer=new Kinetic.Layer;textLayer=new Kinetic.Layer;secondTextLayer=new Kinetic.Layer;popUpLayer=new Kinetic.Layer;log("Stage and Layers has been set");stage.on("click",function(){log("Mouse Position "+stage.getMousePosition().x+","+stage.getMousePosition().y)})}function setQuest(a){levelSave=a;log("levelSave: "+levelSave);allProgress=(progress[1]+progress[2]+progress[3]+progress[4])/4;progress[levelSave]=goodInLevel[levelSave]/5*100;log("progress "+progress+"%");if(inLevel==questNumber&&questNumber!=0){log("inLevel == questNumber"+inLevel+"--"+questNumber);log("Level Finished");log("setQuest Stage Reset and Int next Level");stage.reset();clear_Memory();switch(a){case 1:initLevel01_Fin();break;case 2:initLevel02_Fin();break;case 3:initLevel03_Fin();break;case 4:initLevel04_Fin();break;default:error_Alert(6)}}else{getRandom(1,15);switch(a){case 1:question_OS=myQuestion1[randomOut];break;case 2:question_OS=myQuestion2[randomOut];break;case 3:question_OS=myQuestion3[randomOut];break;case 4:question_OS=myQuestion4[randomOut];break;default:error_Alert(1)}availableQuests()}}function availableQuests(){if(debug==1){console.log("goodquests Level:"+levelSave)}switch(levelSave){case 1:if(goodQuestsL1[randomOut]==1){setQuest(levelSave);if(debug==1){console.log("goodquests1 returned an 1 on array: "+randomOut)}}else{setAnswer(randomOut);if(debug==1){console.log("Resume process --> questionID:"+randomOut+"\n Player never had this Question Good")}}break;case 2:if(goodQuestsL2[randomOut]==1){setQuest(levelSave);if(debug==1){console.log("goodquests2 returned an 1 on array: "+randomOut)}}else{setAnswer(randomOut);if(debug==1){console.log("Resume process --> questionID:"+randomOut+"\n Player never had this Question Good")}}break;case 3:if(goodQuestsL3[randomOut]==1){setQuest(levelSave);if(debug==1){console.log("goodquests3 returned an 1 on array: "+randomOut)}}else{setAnswer(randomOut);if(debug==1){console.log("Resume process --> questionID:"+randomOut+"\n Player never had this Question Good")}}break;case 4:if(goodQuestsL4[randomOut]==1){setQuest(levelSave);if(debug==1){console.log("goodquests4 returned an 1 on array: "+randomOut)}}else{setAnswer(randomOut);if(debug==1){console.log("Resume process --> questionID:"+randomOut+"\n Player never had this Question Good")}}break;case 5:if(goodQuestsL5[randomOut]==1){setQuest(levelSave);if(debug==1){console.log("goodquests returned an 1 on array: "+randomOut)}}else{setAnswer(randomOut);if(debug==1){console.log("Resume process --> questionID:"+randomOut+"\n Player never had this Question Good")}}break;default:error_Alert(7)}}function setAnswer(a){log("START set Answer, qid: "+a);switch(levelSave){case 1:answerArray=myAnswer1[a].split("^");break;case 2:answerArray=myAnswer2[a].split("^");break;case 3:answerArray=myAnswer3[a].split("^");break;case 4:answerArray=myAnswer4[a].split("^");break;default:error_Alert(8)}if(answerArray[4]=="undifined"||answerArray[4]==null){error_Alert(3)}answer1=answerArray[0];answer2=answerArray[1];answer3=answerArray[2];answer4=answerArray[3];answerGood=answerArray[4];questNumber++;setHText(100,0,15,"Level: "+levelSave);setHText(225,0,15,"Vraag: "+questNumber+"/"+inLevel);setScoreText(125,465,30,String(score[levelSave]));setHText(200,470,20," Score");setHText(450,470,20,progress[levelSave]+"%");setQText(200,50,question_OS);setAText(300,150);log("END set Answer, qid: "+a)}function checkAnswer(a){var b=answerGood;var c=randomOut;if(debug==1){console.log("randomOut"+randomOut);console.log("answerGood"+answerGood);console.log("Chosen"+a);console.log("good"+b);console.log("qid"+c)}if(a==b){if(debug==1){console.log("Answer is correct: "+a+":-:"+answerGood)}goodInLevel[levelSave]++;allGood++;log("funt  checkAnswer - switch qid: "+c+"level: "+levelSave);switch(levelSave){case 1:goodQuestsL1[c]=1;break;case 2:goodQuestsL2[c]=1;break;case 3:goodQuestsL3[c]=1;break;case 4:goodQuestsL4[c]=1;break;case 5:goodQuestsL5[c]=1;break;default:log("ERROR: Switch GoodQuest got LevelSave int outside Range ERROR - R260")}score[levelSave]+=10;showAnswer(1,c);setTimeout(function(){nextQuest();setQuest(levelSave)},5e3);if(debug==1){switch(levelSave){case 1:console.log("goodQuests: "+goodQuestsL1[c]);break;case 2:console.log("goodQuests: "+goodQuestsL2[c]);break;case 3:console.log("goodQuests: "+goodQuestsL3[c]);break;case 4:console.log("goodQuests: "+goodQuestsL4[c]);break;case 5:console.log("goodQuests: "+goodQuestsL5[c]);break;default:log("ERROR: Switch GoodQuest got LevelSave int outside Range ERROR R293")}console.log("inLevel"+inLevel);console.log("Score:"+score[levelSave])}}else{if(debug==1){console.log("Answer is False: "+a+":-:"+answerGood)}score[levelSave]-=5;showAnswer(0,c)}}function nextQuest(){log("nextQuest Start");characterLayer.removeChildren();textLayer.removeChildren();characterLayer.draw();textLayer.draw();log("nextQuest Done - r192 engine.js")}function showAnswer(a,b){var c=0;var d=150;var e;var f;if(a==1){f="#8EEB00";e="Correct antwoord";setGText(c,d,e,f)}if(a==0){f="#FF2C00";e="Fout antwoord";setGText(c,d,e,f);if(debug==1){console.log("Set Gtext: "+e+"Color: "+f)}setTimeout(function(){setScoreText(125,437,40,String(score[levelSave]));setHText(200,450,20," Score");textLayer.removeChildren();characterLayer.removeChildren();setText(300,125,"Je hebt de vraag fout beantwoord. \n"+question_OS+"\n\n het juiste antwoord is: \n"+answerArray[answerGood-1]);var a=new Image;switch(levelSave){case 1:a.src="assets/leraren/willem_k.png";break;case 2:a.src="assets/leraren/luc_k.png";break;case 3:a.src="assets/leraren/rene_k.png";break;case 4:a.src="assets/leraren/robin_k.png";break;default:error_Alert(10)}var b=new Image;b.src="assets/button.png";a.onload=function(){var b=new Kinetic.Image({x:700,y:75,image:a});characterLayer.add(b)};b.onload=function(){var a=new Kinetic.Image({x:420,y:300,image:b});a.on("mouseup",function(){nextQuest();setQuest(levelSave)});a.on("mouseover",function(){log("Mouse Over Continue")});textLayer.add(a);characterLayer.draw();textLayer.draw();hudLayer.moveToTop();textLayer.moveToTop()}},5e3)}}function getRandom(a,b){randomOut=Math.floor((b-(a-1))*Math.random())+a}function diff(a){var b=1;if(played[a]=1&&progress[a]==100){b=3}else if(played[a]=1&&progress[a]<=80){b=2}else if(played[a]=1&&progress[a]<=40){b=1}return b}function setStatusLevel(){log("check and set status Levels - R499 - engine.JS");if(progress[1]>=75){statusLevel[1]=3;statusLevel[2]=1}if(progress[1]<75&&played[1]==1){statusLevel[1]=4}if(progress[2]>=75){statusLevel[2]=3}if(progress[2]<75&&played[2]==1){statusLevel[2]=4}if(progress[1]>=75&&progress[2]>=75){statusLevel[3]=1}if(progress[3]>=75){statusLevel[4]=1}if(progress[4]>=75){levelFinal=1}if(progress[3]>=75){statusLevel[3]=3}if(progress[3]<75&&played[3]==1){statusLevel[3]=4}if(progress[4]>=75){statusLevel[4]=3}if(progress[4]<75&&played[4]==1){statusLevel[4]=4}}function clear_Level(a){progress[a]=0;goodInLevel[a]=0;switch(a){case 1:log("goodQuestL1 is set to 0");goodQuestsL1=0;score[1]=0;log("Score: "+score[1]);break;case 2:log("goodQuestL2 is set to 0");goodQuestsL2=0;score[2]=0;log("Score: "+score[2]);break;case 3:log("goodQuestL3 is set to 0");goodQuestsL3=0;score[3]=0;log("Score: "+score[3]);break;case 4:log("goodQuestL4 is set to 0");goodQuestsL4=0;score[4]=0;log("Score: "+score[4]);break;default:error_Alert(8)}}function wipe_Memory(){credits.currentTime=0;underGame.currentTime=0;final.currentTime=0;question_OS=0;levelSave=0;difficultySave=0;roaming=0;timeCount=0;score[0]=0;score[1]=0;score[2]=0;score[3]=0;score[4]=0;allProgress=0;progress[1]=0;progress[2]=0;progress[3]=0;progress[4]=0;goodInLevel[1]=0;goodInLevel[2]=0;goodInLevel[3]=0;goodInLevel[4]=0;allGood=0;inLevel=0;questNumber=0;levelFinal=0;statusLevel[1]=1;statusLevel[2]=1;statusLevel[3]=2;statusLevel[4]=2;timeLeft=null}function clear_Memory(){log("clear_Memory start: r207 - engine.js");log("question_OS : "+question_OS+"randomOut: "+randomOut+"\n inLevel: "+inLevel+"questNumber: "+questNumber);question_OS=null;randomOut=null;inLevel=0;questNumber=0;log(" Variables CLEARED --> \n question_OS : "+question_OS+"randomOut: "+randomOut+"\n inLevel: "+inLevel+"questNumber: "+questNumber);log("clear_Memory Done: r216 - engine.js")}function log(a){if(debug==1){console.log(a)}}function error_Alert(a){if(debug==1){switch(a){case 1:console.log("An error has occurred: with id:"+a+"setQuest(SwitchLevel) Returned an error: Level Int outside Range, under 1 or higher than 4");alert("An error has occurred: with id:"+a+"setQuest(SwitchLevel) Returned an error: Level Int outside Range, under 1 or higher than 4");break;case 2:console.log("An error has occurred: with id:"+a+"NO LONGER ACTIVE - setQuest (DifficultySwitch) Returned an error: Difficulty Int outside Range, under 1 or higher than 4");alert("An error has occurred: with id:"+a+"setQuest (DifficultySwitch) Returned an error: Difficulty Int outside Range, under 1 or higher than 4");break;case 3:console.log("An error has occurred: with id:"+a+"setAnswer read an array that was to small (answerArray[4] == undifined or NULL");alert("An error has occurred: with id:"+a+"setAnswer read an array that was to small (answerArray[4] == undifined or NULL");break;case 4:log("An error has occurred: with id:"+a+"checkAnswer returned VAR 'CHOSEN' ISNT in  Range or not and integer");alert("An error has occurred: with id:"+a+"checkAnswer returned VAR 'CHOSEN' ISNT in  Range or not and integer");break;case 5:log("An error has occurred: with id:"+a+"Kinetic returned an error Layer.moveToTop cannot move layer after setQuest function in an Level");alert("An error has occurred: with id:"+a+"Kinetic returned an error Layer.moveToTop");break;case 6:alert("An error has occurred: with id:"+a+"LevelFinish Switch returned invalid Var to low or to High");log("An error has occurred: with id:"+a+"LevelFinish Switch returned invalid Var to low or to High");break;case 7:alert("An error has occurred: with id:"+a+"quest checker R105: engine.js :: invalid switch integer and went to default-> \n ERROR LevelSave return outside range");break;case 8:alert("An error has occurred: with id:"+a+"Function Clear Level - returned an ERROR: switch level is out of range of switch >>!!!!! CANT CLEAR LEVEL !!!!!");break;case 9:alert("An error has occurred: with id:"+a+"switch level answerArray: R217 engine.js");break;case 10:alert("An error has occurred: with id:"+a+" Switch leraar - returned an int outside range - R444 engine.js");break;case 11:alert("An error has occurred: with id:"+a+"");break;default:Console.log("An error has occurred: with id:"+a+"Unknown Error, error Alert Got Triggert with unkown id Int");alert("An error has occurred: with id:"+a+"Unknown Error, error Alert Got Triggert with unkown id Int")}}}function setAchievement(a){showPopUp(achievementText[a])}function showPopUp(a){if(popupActive==0){popupActive=1;achievement.currentTime=0;achievement.play();log("R: 593 engine.js: show PopUp function start");stage.add(popUpLayer);var b="ACHIEVEMENT UNLOCKED";var c=15;var d=12;var e=300;var f=80;var g=375;var h=50;var i=375;var j=90;var k=375;var l=110;var m=305;var n=82;var o=new Kinetic.Rect({x:e,y:f,width:g,height:h,opacity:0,fill:"#575151",cornerRadius:25});var b=new Kinetic.Text({x:i,y:j,opacity:0,text:b,fontSize:c,fontFamily:"Calibri",textStrokeWidth:-5,textStroke:"white",listening:"false"});var a=new Kinetic.Text({x:k,y:l,opacity:0,text:a,fontSize:d,fontFamily:"Calibri",textStrokeWidth:-5,textStroke:"white",listening:"false"});var p=new Kinetic.Group;p.add(o);p.add(b);p.add(a);popUpLayer.add(p);var q=new Image;q.src="assets/pop_icon.png";var r;q.onload=function(){r=new Kinetic.Image({x:m,y:n,opacity:0,image:q});popUpLayer.add(r);popUpLayer.moveToTop();popUpLayer.draw();popUpLayer.moveToTop();log("Pop Up transition fade-in start");o.transitionTo({opacity:1,duration:1});b.transitionTo({opacity:1,duration:1});a.transitionTo({opacity:1,duration:1});r.transitionTo({opacity:1,duration:1});log("Pop Up transition fade-in stop")};log("R:657 engine.JS: Done drawing pop up");setTimeout(function(){log("Pop Up transition fade-out start");o.transitionTo({opacity:0,duration:1});b.transitionTo({opacity:0,duration:1});a.transitionTo({opacity:0,duration:1});r.transitionTo({opacity:0,duration:1});log(" Pop Up transition fade-out stop")},5e3);setTimeout(function(){log("Remove popUpLayer");stage.remove(popUpLayer);log("Remove popUpLayer: DONE");popupActive=0},8e3)}else{log("popup is already on screen :: "+popupActive)}}function reset_CollisionField(){a_X1="";a_Y1="";a_X2="";a_Y2="";if(debug==1){console.log("Collison Field Reset: "+a_X1+a_Y1+a_X2+a_Y2+"(if empty its OK, means it got Cleared)")}}function setCText(a,b,c,d){if(debug==1){console.log("Set Stext: "+d)}credits_MainText=new Kinetic.Text({x:a,y:b,text:d,fontSize:c,fontFamily:"Calibri",textFill:"white",align:"center",shadow:{color:"black",blur:1,offset:[2,2],opacity:0},opacity:0});textLayer.add(credits_MainText);textLayer.draw();credits_MainText.transitionTo({opacity:1,duration:2});textLayer.draw()}function setSelectText(a){if(debug==1){console.log("Set Stext: "+a)}s_SelectText=new Kinetic.Text({x:55,y:375,text:a,fontSize:40,fontFamily:"Calibri",textFill:"white",align:"center",shadow:{color:"black",blur:1,offset:[5,5],opacity:0},opacity:0});secondTextLayer.add(s_SelectText);secondTextLayer.draw();s_SelectText.transitionTo({opacity:1,duration:1});secondTextLayer.draw();secondTextLayer.moveToTop()}function setGText(a,b,c,d){s_GoodText=new Kinetic.Text({x:a,y:b,stroke:"white",strokeWidth:5,fill:d,text:c,fontSize:14,fontFamily:"Calibri",textFill:"white",width:950,padding:20,align:"center",shadow:{color:"black",blur:1,offset:[5,5],opacity:0},cornerRadius:20,opacity:0});textLayer.add(s_GoodText);textLayer.draw();s_GoodText.transitionTo({opacity:.7,duration:2})}function setQText(a,b,c){log("Set Qtext: "+c);var d=new Kinetic.Text({x:a,y:b,stroke:"#ecede9",strokeWidth:5,fill:{start:{x:0,y:0},end:{x:380,y:200},colorStops:[0,"#4F2009",1,"black"]},text:c,fontSize:14,fontFamily:"Calibri",textFill:"white",width:600,padding:20,align:"center",shadow:{color:"black",blur:1,offset:[10,10],opacity:0},cornerRadius:20,opacity:0});textLayer.add(d);textLayer.draw();d.transitionTo({opacity:.7,duration:2})}function setAText(a,b){log("Set Atext: "+answer1+" - "+answer2+" - "+answer3+" - "+answer4);var c=new Kinetic.Text({x:a,y:b,stroke:"#ecede9",strokeWidth:5,fill:{start:{x:0,y:0},end:{x:200,y:200},colorStops:[0,"#4F2009",1,"black"]},text:"A. "+answer1,fontSize:14,fontFamily:"Calibri",textFill:"white",width:380,padding:20,align:"center",shadow:{color:"black",blur:1,offset:[10,10],opacity:0},cornerRadius:20,opacity:0});c.on("mouseup",function(){log("mouseuped A, Go to checkAnswer with 1 (A)");checkAnswer(1);c.off("mouseup");d.off("mouseup");e.off("mouseup");f.off("mouseup")});c.on("mouseover",function(){c.setFill({start:{x:0,y:0},end:{x:380,y:200},colorStops:[0,"white",1,"black"]});textLayer.draw()});c.on("mouseout",function(){c.setFill({start:{x:0,y:0},end:{x:380,y:200},colorStops:[0,"#4F2009",1,"black"]});textLayer.draw()});textLayer.add(c);textLayer.draw();c.transitionTo({opacity:.7,duration:2});var d=new Kinetic.Text({x:a,y:b+50,stroke:"#ecede9",strokeWidth:5,fill:{start:{x:0,y:0},end:{x:200,y:200},colorStops:[0,"#4F2009",1,"black"]},text:"B. "+answer2,fontSize:14,fontFamily:"Calibri",textFill:"white",width:380,padding:20,align:"center",shadow:{color:"black",blur:1,offset:[10,10],opacity:0},cornerRadius:20,opacity:0});d.on("mouseup",function(){if(debug==1){console.log("mouseuped B, Go to checkAnswer with 2 (B)")}checkAnswer(2);c.off("mouseup");d.off("mouseup");e.off("mouseup");f.off("mouseup")});d.on("mouseover",function(){d.setFill({start:{x:0,y:0},end:{x:380,y:200},colorStops:[0,"white",1,"black"]});textLayer.draw()});d.on("mouseout",function(){d.setFill({start:{x:0,y:0},end:{x:380,y:200},colorStops:[0,"#4F2009",1,"black"]});textLayer.draw()});textLayer.add(d);textLayer.draw();d.transitionTo({opacity:.7,duration:2});var e=new Kinetic.Text({x:a,y:b+100,stroke:"#ecede9",strokeWidth:5,fill:{start:{x:0,y:0},end:{x:200,y:200},colorStops:[0,"#4F2009",1,"black"]},text:"C. "+answer3,fontSize:14,fontFamily:"Calibri",textFill:"white",width:380,padding:20,align:"center",shadow:{color:"black",blur:1,offset:[10,10],opacity:0},cornerRadius:20,opacity:0});e.on("mouseup",function(){if(debug==1){console.log("mouseuped C, Go to checkAnswer with 3 (C)")}checkAnswer(3);c.off("mouseup");d.off("mouseup");e.off("mouseup");f.off("mouseup")});e.on("mouseover",function(){e.setFill({start:{x:0,y:0},end:{x:380,y:200},colorStops:[0,"white",1,"black"]});textLayer.draw()});e.on("mouseout",function(){e.setFill({start:{x:0,y:0},end:{x:380,y:200},colorStops:[0,"#4F2009",1,"black"]});textLayer.draw()});textLayer.add(e);textLayer.draw();e.transitionTo({opacity:.7,duration:2});var f=new Kinetic.Text({x:a,y:b+150,stroke:"#ecede9",strokeWidth:5,fill:{start:{x:0,y:0},end:{x:200,y:200},colorStops:[0,"#4F2009",1,"black"]},text:"D. "+answer4,fontSize:14,fontFamily:"Calibri",textFill:"white",width:380,padding:20,align:"center",shadow:{color:"black",blur:1,offset:[10,10],opacity:0},cornerRadius:20,opacity:0});f.on("mouseup",function(){if(debug==1){console.log("mouseuped D, Go to checkAnswer with 4 (D)")}checkAnswer(4);c.off("mouseup");d.off("mouseup");e.off("mouseup");f.off("mouseup")});f.on("mouseover",function(){f.setFill({start:{x:0,y:0},end:{x:380,y:200},colorStops:[0,"white",1,"black"]});textLayer.draw()});f.on("mouseout",function(){f.setFill({start:{x:0,y:0},end:{x:380,y:200},colorStops:[0,"#4F2009",1,"black"]});textLayer.draw()});textLayer.add(f);textLayer.draw();f.transitionTo({opacity:.7,duration:2})}function setScoreText(a,b,c,d){if(debug==1){console.log("Set Scoretext: "+d)}s_ScoreText=new Kinetic.Text({x:a,y:b,text:d,fontSize:c,fontFamily:"Calibri",textFill:"orange",align:"center",shadow:{color:"black",blur:1,offset:[5,5],opacity:0},opacity:1});textLayer.add(s_ScoreText);textLayer.draw()}function setHText(a,b,c,d){if(debug==1){console.log("Set Htext: "+d)}s_HText=new Kinetic.Text({x:a,y:b,text:d,fontSize:c,fontFamily:"Calibri",textFill:"White",align:"center",shadow:{color:"black",blur:1,offset:[5,5],opacity:0},opacity:1});textLayer.add(s_HText);textLayer.draw()}function setBText(a,b,c,d){if(debug==1){console.log("Set Btext: "+d)}s_bckText=new Kinetic.Text({x:a,y:b,text:d,fontSize:c,fontFamily:"Calibri",textFill:"White",align:"center",shadow:{color:"black",blur:1,offset:[5,5],opacity:0},opacity:0});s_bckText.on("mouseup",function(){roaming=1;stage.reset();initRoam(10)});s_bckText.on("mouseover",function(){s_bckText.setTextFill("red")});s_bckText.on("mouseout",function(){s_bckText.setTextFill("white")});textLayer.add(s_bckText);textLayer.draw();s_bckText.transitionTo({opacity:1,duration:2});textLayer.draw()}function setSText(a,b,c,d){if(debug==1){console.log("Set Stext: "+d)}s_MainText=new Kinetic.Text({x:a,y:b,text:d,fontSize:c,fontFamily:"Calibri",textFill:"White",align:"center",shadow:{color:"black",blur:1,offset:[5,5],opacity:0},opacity:0});textLayer.add(s_MainText);textLayer.draw();s_MainText.transitionTo({opacity:.7,duration:2});textLayer.draw()}function setText(a,b,c){if(debug==1){console.log("Set text: "+c)}m_MainText=new Kinetic.Text({x:a,y:b,stroke:"#ecede9",strokeWidth:5,fill:{start:{x:0,y:0},end:{x:200,y:200},colorStops:[0,"#4F2009",1,"black"]},text:c,fontSize:14,fontFamily:"Calibri",textFill:"white",width:380,padding:20,align:"center",shadow:{color:"black",blur:1,offset:[5,5],opacity:0},cornerRadius:20,opacity:0});textLayer.add(m_MainText);textLayer.draw();m_MainText.transitionTo({opacity:.7,duration:2})}function initLevel01(){inLevel=5;stage.add(backgroundLayer);stage.add(hudLayer);stage.add(characterLayer);stage.add(textLayer);log("Start Level01");var a=new Image;a.src="assets/he1.png";var b=new Image;b.src="assets/l01/01.png";a.onload=function(){var b=new Kinetic.Image({x:0,y:0,image:a});hudLayer.add(b);hudLayer.draw()};b.onload=function(){var a=new Kinetic.Image({x:0,y:0,image:b,draggable:false});backgroundLayer.add(a);backgroundLayer.draw();log("Done Loading - Level01 /n Idle");log("Set Hud Stats");log("set Text levelHUD - R145 engine.js");log("set Text questionHUD - R146 engine.js");log("Set Quests");setQuest(1);lastPlayed=1;log("Done Setting Hud Stats");try{characterLayer.moveToTop();textLayer.moveToTop()}catch(c){error_Alert(5)}}}function initLevel02(){inLevel=5;stage.add(backgroundLayer);stage.add(hudLayer);stage.add(characterLayer);stage.add(textLayer);log("Start Level02");var a=new Image;a.src="assets/he1.png";var b=new Image;b.src="assets/l02/01.png";a.onload=function(){var b=new Kinetic.Image({x:0,y:0,image:a});hudLayer.add(b);hudLayer.draw()};b.onload=function(){var a=new Kinetic.Image({x:0,y:0,image:b,draggable:false});backgroundLayer.add(a);backgroundLayer.draw();log("Done Loading - Level02 /n Idle");log("Set Hud Stats");log("set Text levelHUD - R145 engine.js");log("set Text questionHUD - R146 engine.js");log("Set Quests");log("levelSave:"+levelSave);setQuest(2);lastPlayed=2;log(levelSave);try{characterLayer.moveToTop();textLayer.moveToTop()}catch(c){error_Alert(5)}}}function initLevel03(){inLevel=5;stage.add(backgroundLayer);stage.add(hudLayer);stage.add(characterLayer);stage.add(textLayer);log("Start Level03");var a=new Image;a.src="assets/he1.png";var b=new Image;b.src="assets/l03/01.png";a.onload=function(){var b=new Kinetic.Image({x:0,y:0,image:a});hudLayer.add(b);hudLayer.draw()};b.onload=function(){var a=new Kinetic.Image({x:0,y:0,image:b,draggable:false});backgroundLayer.add(a);backgroundLayer.draw();log("Done Loading - Level03 /n Idle");log("Set Hud Stats");log("set Text levelHUD - R145 engine.js");log("set Text questionHUD - R146 engine.js");log("Set Quests");log("levelSave:"+levelSave);setQuest(3);lastPlayed=3;log(levelSave);try{characterLayer.moveToTop();textLayer.moveToTop()}catch(c){error_Alert(5)}}}function initLevel04(){inLevel=5;stage.add(backgroundLayer);stage.add(hudLayer);stage.add(characterLayer);stage.add(textLayer);log("Start Level04");var a=new Image;a.src="assets/he1.png";var b=new Image;b.src="assets/l04/01.png";a.onload=function(){var b=new Kinetic.Image({x:0,y:0,image:a});hudLayer.add(b);hudLayer.draw()};b.onload=function(){var a=new Kinetic.Image({x:0,y:0,image:b,draggable:false});backgroundLayer.add(a);backgroundLayer.draw();log("Done Loading - Level04 /n Idle");log("Set Hud Stats");log("set Text levelHUD - R145 engine.js");log("set Text questionHUD - R146 engine.js");log("Set Quests");log("levelSave:"+levelSave);setQuest(4);lastPlayed=4;log(levelSave);try{characterLayer.moveToTop();textLayer.moveToTop()}catch(c){error_Alert(5)}}}function initFinal(){timeLeft=40;stage.add(backgroundLayer);stage.add(hudLayer);stage.add(characterLayer);stage.add(textLayer);stage.add(secondTextLayer);log("Start (Final)");rect=new Kinetic.Rect({x:0,y:0,width:950,height:500,fill:"#323231"});backgroundLayer.add(rect);backgroundLayer.draw();var a=new Image;a.src="assets/leraren/ler_k.png";a.onload=function(){leraren=new Kinetic.Image({x:5,y:475,image:a,draggable:false});characterLayer.add(leraren);characterLayer.draw();leraren.transitionTo({y:200,duration:1})};setTimeout(function(){drawFinalText(1,"Versla alle leraren")},2050);setTimeout(function(){leraren.transitionTo({y:600,duration:1})},12e3);setTimeout(function(){initBattle()},14100)}function initBattle(){underGame.pause();final.play();characterLayer.remove(leraren);backgroundLayer.remove(rect);hudLayer.moveToTop();var a=new Image;a.src="assets/final/bg.png";var b=new Image;b.src="assets/he1.png";a.onload=function(){background=new Kinetic.Image({x:0,y:0,image:a,draggable:false,scale:{x:1,y:3}});backgroundLayer.add(background);backgroundLayer.draw();hudLayer.moveToTop();background.transitionTo({scale:{x:1,y:1},duration:1});hudLayer.moveToTop();hudElement=new Kinetic.Image({x:0,y:0,image:b,opacity:0,scale:{x:1,y:3}});hudLayer.add(hudElement);hudLayer.draw();hudLayer.moveToTop();hudElement.transitionTo({scale:{x:1,y:1},opacity:1,duration:1});secondTextLayer.moveToTop()};circle1=new Kinetic.Circle({x:stage.getWidth()/2,y:5,radius:5,fill:"red",stroke:"black",strokeWidth:2});circle2=new Kinetic.Circle({x:stage.getWidth()/2+15,y:5,radius:5,fill:"red",stroke:"black",strokeWidth:2});circle3=new Kinetic.Circle({x:stage.getWidth()/2+30,y:5,radius:5,fill:"red",stroke:"black",strokeWidth:2});circle4=new Kinetic.Circle({x:stage.getWidth()/2+45,y:5,radius:5,fill:"red",stroke:"black",strokeWidth:2});circle5=new Kinetic.Circle({x:stage.getWidth()/2+60,y:5,radius:5,fill:"red",stroke:"black",strokeWidth:2});secondTextLayer.add(circle1);secondTextLayer.add(circle2);secondTextLayer.add(circle3);secondTextLayer.add(circle4);secondTextLayer.add(circle5);secondTextLayer.moveToTop();secondTextLayer.draw();teacher1()}function teacher1(){var a=new Image;a.src="assets/leraren/math_k.png";a.onload=function(){teacher=new Kinetic.Image({x:1e3,y:50,image:a,draggable:false});characterLayer.add(teacher);characterLayer.draw();characterLayer.moveToTop();hudLayer.moveToTop();secondTextLayer.moveToTop();teacher.transitionTo({x:650,duration:1});setTimeout(function(){drawFinalText(1,"Jij denkt het wel te gaan maken, laten we maar eens zien. Hier komt een reken vraag.")},2e3);setTimeout(function(){teacher.transitionTo({x:700,y:65,scale:{x:.5,y:.5},duration:1})},1e4);setTimeout(function(){setFinalQText(1)},13e3);setTimeout(function(){setFinalAText(1);setTimer(1);drawFinalTime(timeLeft)},13300)}}function teacher2(){var a=new Image;a.src="assets/leraren/willem_k.png";a.onload=function(){teacher=new Kinetic.Image({x:1e3,y:50,image:a,draggable:false});characterLayer.add(teacher);characterLayer.draw();characterLayer.moveToTop();hudLayer.moveToTop();secondTextLayer.moveToTop();teacher.transitionTo({x:650,duration:1});setTimeout(function(){drawFinalText(1,"Waarom geef je het nu niet al op, dat is makkelijker.")},2e3);setTimeout(function(){teacher.transitionTo({x:700,y:65,scale:{x:.5,y:.5},duration:1})},1e4);setTimeout(function(){setFinalQText(2)},13e3);setTimeout(function(){setFinalAText(2);setTimer(2)},13300)}}function teacher3(){var a=new Image;a.src="assets/leraren/robin_k.png";a.onload=function(){teacher=new Kinetic.Image({x:1e3,y:50,image:a,draggable:false});characterLayer.add(teacher);characterLayer.draw();characterLayer.moveToTop();hudLayer.moveToTop();secondTextLayer.moveToTop();teacher.transitionTo({x:650,duration:1});setTimeout(function(){drawFinalText(1,"Ik denk wel dat je het kan.. succes")},2e3);setTimeout(function(){teacher.transitionTo({x:700,y:65,scale:{x:.5,y:.5},duration:1})},1e4);setTimeout(function(){setFinalQText(3)},13e3);setTimeout(function(){setFinalAText(3);setTimer(3)},13300)}}function teacher4(){var a=new Image;a.src="assets/leraren/luc_k.png";a.onload=function(){teacher=new Kinetic.Image({x:1e3,y:50,image:a,draggable:false});characterLayer.add(teacher);characterLayer.draw();characterLayer.moveToTop();hudLayer.moveToTop();secondTextLayer.moveToTop();teacher.transitionTo({x:650,duration:1});setTimeout(function(){drawFinalText(1,"Unity is geweldig, het zou zonde zijn als je dat zou missen.")},2e3);setTimeout(function(){teacher.transitionTo({x:700,y:65,scale:{x:.5,y:.5},duration:1})},1e4);setTimeout(function(){setFinalQText(4)},13e3);setTimeout(function(){setFinalAText(4);setTimer(4)},13300)}}function teacher5(){var a=new Image;a.src="assets/leraren/rene_k.png";a.onload=function(){teacher=new Kinetic.Image({x:1e3,y:50,image:a,draggable:false});characterLayer.add(teacher);characterLayer.draw();characterLayer.moveToTop();hudLayer.moveToTop();secondTextLayer.moveToTop();teacher.transitionTo({x:650,duration:1});setTimeout(function(){drawFinalText(1,"We vinden de 3 p's heel belangrijk mensen, dat moet terug komen in ons werk, dus nu ook.")},2e3);setTimeout(function(){teacher.transitionTo({x:700,y:65,scale:{x:.5,y:.5},duration:1})},1e4);setTimeout(function(){setFinalQText(5)},13e3);setTimeout(function(){setFinalAText(5);setTimer(5)},13300)}}function setTimer(a){timerLevel[a]=setInterval(function(){timeLeft--;tText.setText(timeLeft+" seconden");textLayer.draw();log("Timer Elapsed : timeLeft: "+timeLeft);if(timeLeft<=20){tText.setTextFill("red")}if(timeLeft<=0){clearInterval(timerLevel[a]);textLayer.draw();lost(a)}},1e3)}function lost(a){transOff();setTimeout(function(){textLayer.removeChildren();textLayer.draw();teacher.transitionTo({x:650,y:50,scale:{x:1,y:1},duration:1})},2e3);setTimeout(function(){if(a==1){log("Draw Final Text 1,1");drawFinalText(1,"Helaas, je bent blijkbaar nog niet goed genoeg, kom terug als je het wel aan kan.")}if(a==2){drawFinalText(1,"Zakken.., had je beter de moeite niet kunnen nemen, probeer opnieuw als je denkt dat je dit keer gaat halen.")}if(a==3){drawFinalText(1,"Jammer, gelukkig kan je het opnieuw proberen, geloof in jezelf.")}if(a==4){drawFinalText(1,"Geen Unity3D voor jou. Probeer het later opnieuw.")}if(a==5){drawFinalText(1,"bijna alle vragen goed, probeer gerust opnieuw voor een revange.")}},2300);setTimeout(function(){secondTextLayer.removeChildren();secondTextLayer.draw();teacher.transitionTo({opacity:0,duration:1});background.transitionTo({x:-951,duration:1});hudElement.transitionTo({x:951,duration:1});backgroundLayer.add(rect);background.moveToTop();backgroundLayer.draw();final.pause();final.currentTime=0},11e3);setTimeout(function(){stage.reset();underGame.play();initRoam(20)},13e3)}function checkFinalAnswer(a,b){clearInterval(timerLevel[a]);switch(a){case 1:if(finalAnswer[15]==b){finalAnswerGood(1)}else{lost(1)}break;case 2:if(finalAnswer[25]==b){finalAnswerGood(2)}else{lost(2)}break;case 3:if(finalAnswer[35]==b){finalAnswerGood(3)}else{lost(3)}break;case 4:if(finalAnswer[45]==b){finalAnswerGood(4)}else{lost(4)}break;case 5:if(finalAnswer[55]==b){finalAnswerGood(5)}else{lost(5)}break}}function finalAnswerGood(a){log("final AnswerGood Started");switch(a){case 1:log("finalAnswerGood Case 1 started");transOff();teacher.transitionTo({x:650,y:50,scale:{x:1,y:1},duration:1});drawFinalText(1,"De vraag is goed beantwoord, Maar geen vragen over kabouter meer voor jou.");setTimeout(function(){teacher.transitionTo({x:951,duration:1})},11e3);setTimeout(function(){circle1.setFill("grey");secondTextLayer.draw();teacher2()},13e3);break;case 2:log("final AnswerGood Case 2 started");transOff();teacher.transitionTo({x:650,y:50,scale:{x:1,y:1},duration:1});drawFinalText(1,"het antwoord is goed, je bewijst mijn tegendeel, vooruit dan maar.");setTimeout(function(){teacher.transitionTo({x:951,duration:1})},11e3);setTimeout(function(){circle2.setFill("grey");secondTextLayer.draw();teacher3()},13e3);break;case 3:log("final AnswerGood Case 3 started");transOff();teacher.transitionTo({x:650,y:50,scale:{x:1,y:1},duration:1});drawFinalText(1,"Als je er voor inzet, kan je veel bereiken zoals je ziet.");setTimeout(function(){teacher.transitionTo({x:951,duration:1})},11e3);setTimeout(function(){circle3.setFill("grey");secondTextLayer.draw();teacher4()},13e3);break;case 4:log("final AnswerGood Case 4 started");transOff();teacher.transitionTo({x:650,y:50,scale:{x:1,y:1},duration:1});drawFinalText(1,"Goed gedaan, Javascript is zoals je ziet helemaal niet moeilijk.");setTimeout(function(){teacher.transitionTo({x:951,duration:1})},11e3);setTimeout(function(){circle4.setFill("grey");secondTextLayer.draw();teacher5()},13e3);break;case 5:circle5.setFill("grey");secondTextLayer.draw();log("final AnswerGood Case 5 started");transOff();teacher.transitionTo({x:650,y:50,scale:{x:1,y:1},duration:1});drawFinalText(1,"De vraag is goed beantwoord, blijkbaar heb je de 3 P's goed onder de knie.");setTimeout(function(){teacher.transitionTo({x:350,scale:{x:2,y:2},duration:1});log("<AUDIO> final.pause");final.pause();log("<AUDIO> final.currenttime = 0");final.currentTime=0},11e3);setTimeout(function(){log("drawFinalText");drawFinalText(1,"Goed gedaan, je hebt alle vragen juist beantwoord.")},13e3);setTimeout(function(){teacher.transitionTo({x:-400,scale:{x:1,y:1},duration:1});hudElement.transitionTo({scale:{x:4,y:4},opacity:0,duration:1})},18e3);setTimeout(function(){hudLayer.removeChildren();textLayer.removeChildren();secondTextLayer.removeChildren();textLayer.draw();secondTextLayer.draw();drawAllTeachers()},22e3);setTimeout(function(){setSText(100,350,15,"Rene van Dijck,");setSText(450,350,15,"Arthur Wouters");setSText(325,350,15,"Robin Hilt");setSText(600,350,15,"Luc Peersman");setSText(775,350,15,"Willem Verlijsdonk")},32e3);setTimeout(function(){log("Set Score and timeleft text");score[0]=score[1]+score[2]+score[3]+score[4];setSText(475,400,20,"Totale score: "+score[0]);setSText(475,430,20,"Tijd over   : "+timeLeft+" Seconden")},36e3);setTimeout(function(){wipe_Memory();stage.reset();initState05()},48e3);break}}function drawAllTeachers(){setTimeout(function(){var a=new Image;a.src="assets/leraren/willem_k.png";a.onload=function(){var b=new Kinetic.Image({x:-300,y:50,image:a,draggable:false});characterLayer.add(b);characterLayer.draw();characterLayer.moveToTop();hudLayer.moveToTop();secondTextLayer.moveToTop();b.transitionTo({x:650,duration:1})}},2e3);setTimeout(function(){var a=new Image;a.src="assets/leraren/luc_k.png";a.onload=function(){var b=new Kinetic.Image({x:-300,y:50,image:a,draggable:false});characterLayer.add(b);characterLayer.draw();characterLayer.moveToTop();hudLayer.moveToTop();secondTextLayer.moveToTop();b.transitionTo({x:500,duration:1})}},4e3);setTimeout(function(){var a=new Image;a.src="assets/leraren/math_k.png";a.onload=function(){var b=new Kinetic.Image({x:-300,y:20,image:a,draggable:false});characterLayer.add(b);characterLayer.draw();characterLayer.moveToTop();hudLayer.moveToTop();secondTextLayer.moveToTop();b.transitionTo({x:350,duration:1})}},6e3);setTimeout(function(){var a=new Image;a.src="assets/leraren/robin_k.png";a.onload=function(){var b=new Kinetic.Image({x:-300,y:50,image:a,draggable:false});characterLayer.add(b);characterLayer.draw();characterLayer.moveToTop();hudLayer.moveToTop();secondTextLayer.moveToTop();b.transitionTo({x:175,duration:1})}},8e3);setTimeout(function(){var a=new Image;a.src="assets/leraren/rene_k.png";a.onload=function(){var b=new Kinetic.Image({x:-300,y:50,image:a,draggable:false});characterLayer.add(b);characterLayer.draw();characterLayer.moveToTop();hudLayer.moveToTop();secondTextLayer.moveToTop();b.transitionTo({x:50,duration:1})}},1e4)}function transOff(){m_FText.transitionTo({x:400,scale:{x:.1,y:.1},opacity:0,duration:1});a_MainText.transitionTo({x:400,scale:{x:.1,y:.1},opacity:0,duration:1});b_MainText.transitionTo({x:400,scale:{x:.1,y:.1},opacity:0,duration:1});c_MainText.transitionTo({x:400,scale:{x:.1,y:.1},opacity:0,duration:1});d_MainText.transitionTo({x:400,scale:{x:.1,y:.1},opacity:0,duration:1})}function setFinalQText(a){log("setFinalQText == qid: "+a);m_FText=new Kinetic.Text({x:-150,y:100,stroke:"#ecede9",strokeWidth:5,fill:{start:{x:0,y:0},end:{x:380,y:200},colorStops:[0,"#4F2009",1,"black"]},text:finalQuestion[a],fontSize:14,fontFamily:"Calibri",textFill:"white",width:600,padding:20,align:"center",shadow:{color:"black",blur:1,offset:[5,5],opacity:0},cornerRadius:20,opacity:.5});textLayer.add(m_FText);textLayer.draw();m_FText.transitionTo({x:300,duration:1});textLayer.moveToTop()}function setFinalAText(a){log("setFinalAText --- qid: "+a);switch(a){case 1:aText=finalAnswer[11];bText=finalAnswer[12];cText=finalAnswer[13];dText=finalAnswer[14];break;case 2:aText=finalAnswer[21];bText=finalAnswer[22];cText=finalAnswer[23];dText=finalAnswer[24];break;case 3:aText=finalAnswer[31];bText=finalAnswer[32];cText=finalAnswer[33];dText=finalAnswer[34];break;case 4:aText=finalAnswer[41];bText=finalAnswer[42];cText=finalAnswer[43];dText=finalAnswer[44];break;case 5:aText=finalAnswer[51];bText=finalAnswer[52];cText=finalAnswer[53];dText=finalAnswer[54];break;default:log("Set Final Answer switch outside range")}a_MainText=new Kinetic.Text({x:1e3,y:250,stroke:"#ecede9",strokeWidth:5,fill:{start:{x:0,y:0},end:{x:380,y:200},colorStops:[0,"#4F2009",1,"black"]},text:"A. "+aText,fontSize:14,fontFamily:"Calibri",textFill:"white",width:600,padding:20,align:"center",shadow:{color:"black",blur:1,offset:[5,5],opacity:0},cornerRadius:20});a_MainText.on("mouseup",function(){if(debug==1){console.log("Clicked A, Go to checkFinalAnswer(A)")}a_MainText.off("mouseup");b_MainText.off("mouseup");c_MainText.off("mouseup");d_MainText.off("mouseup");checkFinalAnswer(a,1)});a_MainText.on("mouseover",function(){a_MainText.setFill({start:{x:0,y:0},end:{x:380,y:200},colorStops:[0,"white",1,"black"]});textLayer.draw()});a_MainText.on("mouseout",function(){a_MainText.setFill({start:{x:0,y:0},end:{x:380,y:200},colorStops:[0,"#4F2009",1,"black"]});textLayer.draw()});textLayer.add(a_MainText);textLayer.draw();a_MainText.transitionTo({x:50,duration:1});b_MainText=new Kinetic.Text({x:1e3,y:300,stroke:"#ecede9",strokeWidth:5,fill:{start:{x:0,y:0},end:{x:380,y:200},colorStops:[0,"#4F2009",1,"black"]},text:"B. "+bText,fontSize:14,fontFamily:"Calibri",textFill:"white",width:600,padding:20,align:"center",shadow:{color:"black",blur:1,offset:[5,5],opacity:0},cornerRadius:20});b_MainText.on("mouseup",function(){if(debug==1){console.log("Clicked B, Go to checkFinalAnswer(B)")}a_MainText.off("mouseup");b_MainText.off("mouseup");c_MainText.off("mouseup");d_MainText.off("mouseup");checkFinalAnswer(a,2)});b_MainText.on("mouseover",function(){b_MainText.setFill({start:{x:0,y:0},end:{x:380,y:200},colorStops:[0,"white",1,"black"]});textLayer.draw()});b_MainText.on("mouseout",function(){b_MainText.setFill({start:{x:0,y:0},end:{x:380,y:200},colorStops:[0,"#4F2009",1,"black"]});textLayer.draw()});textLayer.add(b_MainText);textLayer.draw();b_MainText.transitionTo({x:50,duration:1});c_MainText=new Kinetic.Text({x:1e3,y:350,stroke:"#ecede9",strokeWidth:5,fill:{start:{x:0,y:0},end:{x:380,y:200},colorStops:[0,"#4F2009",1,"black"]},text:"C."+cText,fontSize:14,fontFamily:"Calibri",textFill:"white",width:600,padding:20,align:"center",shadow:{color:"black",blur:1,offset:[5,5],opacity:0},cornerRadius:20});c_MainText.on("mouseup",function(){if(debug==1){console.log("Clicked C, Go to checkFinalAnswer(C)")}a_MainText.off("mouseup");b_MainText.off("mouseup");c_MainText.off("mouseup");d_MainText.off("mouseup");checkFinalAnswer(a,3)});c_MainText.on("mouseover",function(){c_MainText.setFill({start:{x:0,y:0},end:{x:380,y:200},colorStops:[0,"white",1,"black"]});textLayer.draw()});c_MainText.on("mouseout",function(){c_MainText.setFill({start:{x:0,y:0},end:{x:380,y:200},colorStops:[0,"#4F2009",1,"black"]});textLayer.draw()});textLayer.add(c_MainText);textLayer.draw();c_MainText.transitionTo({x:50,duration:1});d_MainText=new Kinetic.Text({x:1e3,y:400,stroke:"#ecede9",strokeWidth:5,fill:{start:{x:0,y:0},end:{x:380,y:200},colorStops:[0,"#4F2009",1,"black"]},text:"D. "+dText,fontSize:14,fontFamily:"Calibri",textFill:"white",width:600,padding:20,align:"center",shadow:{color:"black",blur:1,offset:[5,5],opacity:0},cornerRadius:20});d_MainText.on("mouseup",function(){if(debug==1){console.log("Clicked D, Go to checkFinalAnswer(D)")}a_MainText.off("mouseup");b_MainText.off("mouseup");c_MainText.off("mouseup");d_MainText.off("mouseup");checkFinalAnswer(a,4)});d_MainText.on("mouseover",function(){d_MainText.setFill({start:{x:0,y:0},end:{x:380,y:200},colorStops:[0,"white",1,"black"]});textLayer.draw()});d_MainText.on("mouseout",function(){d_MainText.setFill({start:{x:0,y:0},end:{x:380,y:200},colorStops:[0,"#4F2009",1,"black"]});textLayer.draw()});textLayer.add(d_MainText);textLayer.draw();d_MainText.transitionTo({x:50,duration:1});textLayer.moveToTop()}function drawFinalTime(a){tText=new Kinetic.Text({x:1e3,y:400,text:a+" Seconden",fontSize:20,fontFamily:"Calibri",textFill:"white",align:"center",opacity:0});textLayer.add(tText);textLayer.draw();tText.transitionTo({opacity:1,x:725,duration:1})}function drawFinalText(a,b){switch(a){case 1:fText1=new Kinetic.Text({x:250,y:110,stroke:"#ecede9",strokeWidth:5,fill:{start:{x:0,y:0},end:{x:200,y:200},colorStops:[0,"#4F2009",1,"black"]},text:b,fontSize:14,fontFamily:"Calibri",textFill:"white",width:380,padding:20,align:"center",shadow:{color:"black",blur:1,offset:[5,5],opacity:0},cornerRadius:20,opacity:0});textLayer.add(fText1);textLayer.draw();fText1.transitionTo({opacity:1,duration:2});setTimeout(function(){fText1.transitionTo({opacity:0,duration:2})},7e4);setTimeout(function(){textLayer.remove(fText1);textLayer.draw()},1e4);break;case 2:fText2=new Kinetic.Text({x:posX,y:posY,stroke:"#ecede9",strokeWidth:5,fill:{start:{x:0,y:0},end:{x:200,y:200},colorStops:[0,"#4F2009",1,"black"]},text:b,fontSize:14,fontFamily:"Calibri",textFill:"white",width:380,padding:20,align:"center",shadow:{color:"black",blur:1,offset:[5,5],opacity:0},cornerRadius:20,opacity:0});textLayer.add(fText2);textLayer.draw();fText2.transitionTo({opacity:1,duration:2});setTimeout(function(){fText2.transitionTo({opacity:0,duration:2})},7e3);setTimeout(function(){textLayer.remove(fText2);textLayer.draw()},1e4);break;default:log("Error Function drawFinal Text id outside switch range")}}function initLevel01_Fin(){stage.add(backgroundLayer);stage.add(characterLayer);stage.add(textLayer);if(debug==1)console.log("Start State Level01 FINISHED");var a=new Image;a.src="assets/bg.png";a.onload=function(){var b=new Kinetic.Image({x:0,y:0,image:a,draggable:false});backgroundLayer.add(b);backgroundLayer.draw();var c=new Kinetic.Rect({x:225,y:10,width:500,height:300,stroke:"#ecede9",strokeWidth:5,fill:{start:{x:0,y:0},end:{x:200,y:200},colorStops:[0,"#4F2009",1,"black"]},cornerRadius:20,opacity:.5});textLayer.add(c);textLayer.draw();setSText(275,20,45,"Level 1 voltooid");setSText(275,120,20,"=================");setSText(275,170,20,"Score: "+score[levelSave]);setSText(275,220,20,"Level voortgang: "+progress[levelSave]+"%");setSText(275,250,20,"=================");setSText(275,280,20,"Algemene voortgang: "+allProgress+"%");try{characterLayer.moveToTop();textLayer.moveToTop()}catch(d){error_Alert(5)}};log("Done Loading - Level01 Finished /n Idle");var b=new Image;b.src="assets/button.png";b.onload=function(){var a=new Kinetic.Image({x:375,y:325,image:b,draggable:false});a.on("mouseup",function(){if(debug==1){console.log("Continue to level select")}played[1]=1;stage.reset();initRoam(30)});textLayer.add(a);textLayer.draw()}}function initLevel02_Fin(){stage.add(backgroundLayer);stage.add(characterLayer);stage.add(textLayer);if(debug==1)console.log("Start State Level02 FINISHED");var a=new Image;a.src="assets/bg.png";a.onload=function(){var b=new Kinetic.Image({x:0,y:0,image:a,draggable:false});backgroundLayer.add(b);backgroundLayer.draw();var c=new Kinetic.Rect({x:225,y:10,width:500,height:300,stroke:"#ecede9",strokeWidth:5,fill:{start:{x:0,y:0},end:{x:200,y:200},colorStops:[0,"#4F2009",1,"black"]},cornerRadius:20,opacity:.5});textLayer.add(c);textLayer.draw();setSText(275,20,45,"Level 2 voltooid");setSText(275,120,20,"=================");setSText(275,170,20,"Score: "+score[levelSave]);setSText(275,220,20,"Level voortgang: "+progress[levelSave]+"%");setSText(275,250,20,"=================");setSText(275,280,20,"Algemene voortgang: "+allProgress+"%");try{characterLayer.moveToTop();textLayer.moveToTop()}catch(d){error_Alert(5)}};log("Done Loading - Level02 Finished /n Idle");var b=new Image;b.src="assets/button.png";b.onload=function(){var a=new Kinetic.Image({x:375,y:325,image:b,draggable:false});a.on("mouseup",function(){if(debug==1){console.log("Continue to level select")}played[2]=1;stage.reset();initRoam(40)});textLayer.add(a);textLayer.draw()}}function initLevel03_Fin(){stage.add(backgroundLayer);stage.add(characterLayer);stage.add(textLayer);if(debug==1)console.log("Start State Level03 FINISHED");var a=new Image;a.src="assets/bg.png";a.onload=function(){var b=new Kinetic.Image({x:0,y:0,image:a,draggable:false});backgroundLayer.add(b);backgroundLayer.draw();var c=new Kinetic.Rect({x:225,y:10,width:500,height:300,stroke:"#ecede9",strokeWidth:5,fill:{start:{x:0,y:0},end:{x:200,y:200},colorStops:[0,"#4F2009",1,"black"]},cornerRadius:20,opacity:.5});textLayer.add(c);textLayer.draw();setSText(275,20,45,"Level 3 voltooid");setSText(275,120,20,"=================");setSText(275,170,20,"Score: "+score[levelSave]);setSText(275,220,20,"Level voortgang: "+progress[levelSave]+"%");setSText(275,250,20,"=================");setSText(275,280,20,"Algemene voortgang: "+allProgress+"%");try{characterLayer.moveToTop();textLayer.moveToTop()}catch(d){error_Alert(5)}};log("Done Loading - Level03 Finished /n Idle");var b=new Image;b.src="assets/button.png";b.onload=function(){var a=new Kinetic.Image({x:375,y:325,image:b,draggable:false});a.on("mouseup",function(){if(debug==1){console.log("Continue to level select")}played[3]=1;stage.reset();initRoam(20)});textLayer.add(a);textLayer.draw()}}function initLevel04_Fin(){stage.add(backgroundLayer);stage.add(characterLayer);stage.add(textLayer);if(debug==1)console.log("Start State Level04 FINISHED");var a=new Image;a.src="assets/bg.png";a.onload=function(){var b=new Kinetic.Image({x:0,y:0,image:a,draggable:false});backgroundLayer.add(b);backgroundLayer.draw();var c=new Kinetic.Rect({x:225,y:10,width:500,height:300,stroke:"#ecede9",strokeWidth:5,fill:{start:{x:0,y:0},end:{x:200,y:200},colorStops:[0,"#4F2009",1,"black"]},cornerRadius:20,opacity:.5});textLayer.add(c);textLayer.draw();setSText(275,20,45,"Level 4 voltooid");setSText(275,120,20,"=================");setSText(275,170,20,"Score: "+score[levelSave]);setSText(275,220,20,"Level voortgang: "+progress[levelSave]+"%");setSText(275,250,20,"=================");setSText(275,280,20,"Algemene voortgang: "+allProgress+"%");if(progress>=75){setAchievement(1)}try{characterLayer.moveToTop();textLayer.moveToTop()}catch(d){error_Alert(5)}};log("Done Loading - Level04 Finished /n Idle");var b=new Image;b.src="assets/button.png";b.onload=function(){var a=new Kinetic.Image({x:375,y:325,image:b,draggable:false});a.on("mouseup",function(){if(debug==1){console.log("Continue to level select")}played[4]=1;stage.reset();initRoam(50)});textLayer.add(a);textLayer.draw()}}function initRoam(a){if(debug==1)console.log("initializing Roam 01 (entrance)");stage.add(backgroundLayer);stage.add(characterLayer);stage.add(textLayer);roamImg=new Image;roamImg.src="assets/createc.png";northImg=new Image;northImg.src="assets/roaming/1.png";southImg=new Image;southImg.src="assets/roaming/2.png";westImg=new Image;westImg.src="assets/roaming/3.png";eastImg=new Image;eastImg.src="assets/roaming/4.png";roamImg.onload=function(){background=new Kinetic.Image({x:0,y:0,image:roamImg,draggable:false,opacity:0});backgroundLayer.add(background);characterLayer.moveToTop();textLayer.moveToTop();background.transitionTo({opacity:1,duration:2})};eastImg.onload=function(){north=new Kinetic.Image({x:stage.getWidth()/2-25,y:stage.getHeight()/4-25,image:northImg,draggable:false,opacity:1});south=new Kinetic.Image({x:stage.getWidth()/2-25,y:stage.getHeight()/4*3-25,image:southImg,draggable:false,opacity:1});west=new Kinetic.Image({x:stage.getWidth()/4-25,y:stage.getHeight()/2-25,image:westImg,draggable:false,opacity:1});east=new Kinetic.Image({x:stage.getWidth()/4*3-25,y:stage.getHeight()/2-25,image:eastImg,draggable:false,opacity:1});var b=new Kinetic.Group;b.add(north);b.add(south);b.add(west);b.add(east);characterLayer.add(b);setStatusLevel();if(levelFinal==1){askFinal()}else{log("loc: "+a);setRoamLocation(a)}};console.log("Done Loading, Roam")}function setRoamLocation(a){log("setRoamLocation("+a+") Start");setStatusLevel();log("check VAR roaming - start");if(roaming==0){log("check VAR roaming = ("+roaming+")");askRoaming()}else if(roaming==1){log("check VAR roaming = ("+roaming+")");delArrowEvents();textLayer.removeChildren();log("roam.js - textLayer Remove Children.");addArrowEvents();switch(a){case 10:log("Roam.js - loc: "+a+" - show and hide arrows, draw text & background");roamImg.src="assets/roaming/r01/01.png";north.show();south.hide();east.hide();west.hide();drawRoamText(1,0,"Ga naar binnen.");north.on("mouseup",function(){if(debug==1){console.log("MouseUp north, go to r02")}textLayer.removeChildren();textLayer.draw();north.hide();south.hide();east.hide();west.hide();setTimeout(function(){roamImg.src="assets/roaming/r01/02.png"},1e3);setTimeout(function(){roamImg.src="assets/roaming/r01/03.png"},2500);setTimeout(function(){roamImg.src="assets/roaming/r01/04.png"},4e3);setTimeout(function(){setRoamLocation(20)},5e3)});break;case 20:log("Roam.js - loc: "+a+" - show and hide arrows, draw text & background");roamImg.src="assets/roaming/r02/01.png";north.hide();south.show();west.show();east.show();drawRoamText(2,0,"Terug naar buiten.");drawRoamText(3,0,"Ga naar de aula");drawRoamText(4,statusLevel[3],"Naar de gymZaal, level03 ("+progress[3]+"%)");south.on("mouseup",function(){if(debug==1){console.log("MouseUp south, go to r01")}setRoamLocation(10)});west.on("mouseup",function(){if(debug==1){console.log("MouseUp west, go to r03")}setRoamLocation(30)});east.on("mouseup",function(){if(debug==1){console.log("MouseUp east, go to Level03")}if(statusLevel[3]==1){stage.reset();initLevel03()}else if(statusLevel[3]==3){askContinue(3)}else if(statusLevel[3]==4){clear_Level(3);stage.reset();initLevel03()}});break;case 30:log("Roam.js - loc: "+a+" - show and hide arrows, draw text & background");roamImg.src="assets/roaming/r03/01.png";north.show();south.show();west.show();east.show();drawRoamText(1,statusLevel[1],"Naar de aula, level01 ("+progress[1]+"%)");drawRoamText(2,0,"Richting ingang - (level03).");drawRoamText(3,0,"G vleugel");drawRoamText(4,0,"Naar de B vleugel");north.on("mouseup",function(){if(debug==1){console.log("MouseUp north, go to r01")}if(statusLevel[1]==1){stage.reset();initLevel01()}else if(statusLevel[1]==3){askContinue(1)}else if(statusLevel[1]==4){clear_Level(1);stage.reset();initLevel01()}});south.on("mouseup",function(){if(debug==1){console.log("MouseUp south, go to r02")}setRoamLocation(20)});west.on("mouseup",function(){if(debug==1){console.log("MouseUp west, go to r04")}setRoamLocation(40)});east.on("mouseup",function(){if(debug==1){console.log("MouseUp west, go to r05")}setRoamLocation(50)});break;case 40:log("Roam.js - loc: "+a+" - show and hide arrows, draw text & background");roamImg.src="assets/roaming/r04/01.png";north.hide();south.show();east.hide();west.show();drawRoamText(2,0,"Ga naar de begane grond");drawRoamText(3,statusLevel[2],"Level 02 - G lokaal. ("+progress[2]+"%)");south.on("mouseup",function(){if(debug==1){console.log("MouseUp north, go to r04")}north.hide();south.hide();east.hide();west.hide();textLayer.removeChildren();setRoamLocation(30)});west.on("mouseup",function(){if(debug==1){console.log("MouseUp west, go to level02")}north.hide();south.hide();east.hide();west.hide();textLayer.removeChildren();if(statusLevel[2]==1){stage.reset();initLevel02()}else if(statusLevel[2]==3){askContinue(2)}else if(statusLevel[2]==4){clear_Level(2);stage.reset();initLevel02()}});break;case 50:log("Roam.js - loc: "+a+" - show and hide arrows, draw text & background");roamImg.src="assets/roaming/r05/01.png";north.hide();south.show();west.show();east.hide();drawRoamText(2,0,"Ga naar de aula");drawRoamText(3,statusLevel[4],"Naar Level 04 ("+progress[4]+"%)");south.on("mouseup",function(){if(debug==1){console.log("MouseUp south, go to r03")}setRoamLocation(30)});west.on("mouseup",function(){if(debug==1){console.log("MouseUp west, go to Level 04")}if(statusLevel[4]==1){stage.reset();initLevel04()}else if(statusLevel[4]==3){askContinue(4)}else if(statusLevel[4]==4){clear_Level(4);stage.reset();initLevel04()}});break;default:log("ERROR: Switch loc got loc int outside Range ERROR ::roam.js:: R148")}}else{log("check VAR roaming = ("+roaming+")");stage.reset();initState07()}log("check VAR roaming is complete")}function drawRoamText(a,b,c){log("roam.js - Draw Roam Text:: dir: "+a);var d;switch(b){case 1:log("Roam.JS - R381 :: Case 1 use in switch State^^ text :"+c);d="#A9F608";c+=" - Open";break;case 2:log("Roam.JS - R386 :: Case 2 use in switch State^^ text :"+c);d="#FF4505";c+=" - Op Slot";break;case 3:log("Roam.JS - R392 :: Case 3 use in switch State^^ text :"+c);d="#3FF6FF";c+=" - Voltooid";break;case 4:log("Roam.JS - R398 :: Case 4 use in switch State^^ text :"+c);d="#FFCB3E";c+=" - Niet behaald, probeer opnieuw";break;default:log("Roam.JS - R404 :: Default use in switch State^^ text :"+c);d="white"}switch(a){case 1:log("Roam.js -draw North Text: ");northText=new Kinetic.Text({x:stage.getWidth()/2-15,y:stage.getHeight()/4+15,text:c,padding:2,fill:"black",fontSize:16,fontFamily:"Calibri",textFill:d,align:"center",opacity:0});textLayer.add(northText);textLayer.draw();northText.transitionTo({opacity:.7,duration:2});if(b==2){north.on("mouseup",function(){levelFirst()})}break;case 2:log("Roam.js -draw south Text: ");southText=new Kinetic.Text({x:stage.getWidth()/2-50,y:stage.getHeight()/4*3-50,text:c,padding:2,fill:"black",fontSize:16,fontFamily:"Calibri",textFill:d,align:"center",opacity:0});textLayer.add(southText);textLayer.draw();southText.transitionTo({opacity:.7,duration:2});if(b==2){south.on("mouseup",function(){levelFirst()})}break;case 3:log("Roam.js -draw west Text: ");westText=new Kinetic.Text({x:stage.getWidth()/4,y:stage.getHeight()/2+25,text:c,padding:2,fill:"black",fontSize:16,fontFamily:"Calibri",textFill:d,align:"center",opacity:0});textLayer.add(westText);textLayer.draw();westText.transitionTo({opacity:.7,duration:2});if(b==2){west.on("mouseup",function(){levelFirst()})}break;case 4:log("Roam.js -draw east Text: ");eastText=new Kinetic.Text({x:stage.getWidth()/4*3-175,y:stage.getHeight()/2+25,text:c,width:300,padding:2,fill:"black",fontSize:16,fontFamily:"Calibri",textFill:d,align:"center",opacity:0});textLayer.add(eastText);textLayer.draw();eastText.transitionTo({opacity:.7,duration:2});if(b==2){east.on("mouseup",function(){levelFirst()})}break;default:log("ERROR: Switch dir got VAR 'dir' int outside Range ERROR ::roam.js:: R171")}}function addArrowEvents(){log("Function addArrowEvents Started");north.on("mouseover",function(){if(debug==1){console.log("MouseUp North, cursor pointer")}document.body.style.cursor="pointer"});north.on("mouseout",function(){if(debug==1){console.log("MouseOut North, cursor default")}document.body.style.cursor="default"});south.on("mouseover",function(){if(debug==1){console.log("MouseUp South, cursor pointer")}document.body.style.cursor="pointer"});south.on("mouseout",function(){if(debug==1){console.log("MouseOut South, cursor default")}document.body.style.cursor="default"});west.on("mouseover",function(){if(debug==1){console.log("MouseUp West, cursor pointer")}document.body.style.cursor="pointer"});west.on("mouseout",function(){if(debug==1){console.log("MouseOut West, cursor default")}document.body.style.cursor="default"});east.on("mouseover",function(){if(debug==1){console.log("MouseUp East, cursor pointer")}document.body.style.cursor="pointer"});east.on("mouseout",function(){if(debug==1){console.log("MouseOut East, cursor default")}document.body.style.cursor="default"});log("Function addArrowEvents Ended")}function delArrowEvents(){log("Function delete ArrowEvents Started");north.off("mouseup");south.off("mouseup");west.off("mouseup");east.off("mouseup");log("Function delete ArrowEvents ended")}function askRoaming(){log("Function askRoaming Started");textLayer.removeChildren();textLayer.draw();var a="Vrij rondlopen of via een map ?";var b="Vrij rondlopen";var c="Gebruik een map";askText=new Kinetic.Text({x:stage.getWidth()/4-100,y:stage.getHeight()/4,text:a,padding:15,stroke:"#ecede9",strokeWidth:5,fill:{start:{x:0,y:0},end:{x:200,y:200},colorStops:[0,"#4F2009",1,"black"]},fontSize:35,fontFamily:"Calibri",textFill:"White",align:"center",opacity:0,cornerRadius:20});textLayer.add(askText);textLayer.draw();askText.transitionTo({opacity:.75,duration:2});q1Text=new Kinetic.Text({x:stage.getWidth()/4-100,y:stage.getHeight()/4*3-150,text:b,padding:15,stroke:"#ecede9",strokeWidth:5,fill:{start:{x:0,y:0},end:{x:200,y:200},colorStops:[0,"#4F2009",1,"black"]},fontSize:25,fontFamily:"Calibri",textFill:"#74FF00",align:"center",opacity:0,cornerRadius:20});q1Text.on("mouseup",function(){if(debug==1){console.log("Mouseup q1")}roaming=1;setRoamLocation(10)});q1Text.on("mouseover",function(){if(debug==1){console.log("MouseOver q1, cursor pointer")}document.body.style.cursor="pointer";q1Text.setTextFill("white");textLayer.draw()});q1Text.on("mouseout",function(){if(debug==1){console.log("MouseOut q1, cursor default")}document.body.style.cursor="default";q1Text.setTextFill("#74FF00");textLayer.draw()});textLayer.add(q1Text);textLayer.draw();q1Text.transitionTo({opacity:.75,duration:2});q2Text=new Kinetic.Text({x:stage.getWidth()/4*3-200,y:stage.getHeight()/4*3-150,text:c,padding:15,stroke:"#ecede9",strokeWidth:5,fill:{start:{x:0,y:0},end:{x:200,y:200},colorStops:[0,"#4F2009",1,"black"]},fontSize:25,fontFamily:"Calibri",textFill:"#FF3100",align:"center",opacity:0,cornerRadius:20});q2Text.on("mouseup",function(){if(debug==1){console.log("Mouseup q2")}roaming=2;setRoamLocation(10)});q2Text.on("mouseover",function(){if(debug==1){console.log("MouseOver q2, cursor pointer")}document.body.style.cursor="pointer";q2Text.setTextFill("white");textLayer.draw()});q2Text.on("mouseout",function(){if(debug==1){console.log("MouseOut q2, cursor default")}document.body.style.cursor="default";q2Text.setTextFill("#FF3100");textLayer.draw()});textLayer.add(q2Text);textLayer.draw();q2Text.transitionTo({opacity:.75,duration:2});textLayer.moveToTop();textLayer.draw();log("Function askRoaming Ended R 815")}function askContinue(a){log("Function askContinue Started");textLayer.removeChildren();textLayer.draw();var b="je verliest de voortgang voor dit level";var c="Doorgaan";var d="toch niet";var e=new Kinetic.Rect({x:0,y:0,width:950,height:500,fill:"grey",stroke:"black",strokeWidth:1,opacity:0});textLayer.add(e);textLayer.draw();e.transitionTo({opacity:.75,duration:1});askText=new Kinetic.Text({x:stage.getWidth()/4-100,y:stage.getHeight()/4,text:b,padding:15,stroke:"#ecede9",strokeWidth:5,fill:{start:{x:0,y:0},end:{x:200,y:200},colorStops:[0,"#4F2009",1,"black"]},fontSize:35,fontFamily:"Calibri",textFill:"White",align:"center",opacity:0,cornerRadius:20});textLayer.add(askText);textLayer.draw();askText.transitionTo({opacity:.75,duration:2});q1Text=new Kinetic.Text({x:stage.getWidth()/4-100,y:stage.getHeight()/4*3-150,text:c,padding:15,stroke:"#ecede9",strokeWidth:5,fill:{start:{x:0,y:0},end:{x:200,y:200},colorStops:[0,"#4F2009",1,"black"]},fontSize:25,fontFamily:"Calibri",textFill:"#74FF00",align:"center",opacity:0,cornerRadius:20});q1Text.on("mouseup",function(){if(debug==1){console.log("Mouseup q1")}if(a==1){clear_Level(1);stage.reset();initLevel01()}else if(a==2){clear_Level(2);stage.reset();initLevel02()}else if(a==3){clear_Level(3);stage.reset();initLevel03()}else if(a==4){clear_Level(4);stage.reset();initLevel04()}});q1Text.on("mouseover",function(){if(debug==1){console.log("MouseOver q1, cursor pointer")}document.body.style.cursor="pointer";q1Text.setTextFill("white");textLayer.draw()});q1Text.on("mouseout",function(){if(debug==1){console.log("MouseOut q1, cursor default")}document.body.style.cursor="default";q1Text.setTextFill("#74FF00");textLayer.draw()});textLayer.add(q1Text);textLayer.draw();q1Text.transitionTo({opacity:.75,duration:2});q2Text=new Kinetic.Text({x:stage.getWidth()/4*3,y:stage.getHeight()/4*3-150,text:d,padding:15,stroke:"#ecede9",strokeWidth:5,fill:{start:{x:0,y:0},end:{x:200,y:200},colorStops:[0,"#4F2009",1,"black"]},fontSize:25,fontFamily:"Calibri",textFill:"#FF3100",align:"center",opacity:0,cornerRadius:20});q2Text.on("mouseup",function(){if(debug==1){console.log("Mouseup q2")}if(a==1){setRoamLocation(30)}else if(a==2){setRoamLocation(40)}else if(a==3){setRoamLocation(20)}else if(a==4){setRoamLocation(50)}});q2Text.on("mouseover",function(){if(debug==1){console.log("MouseOver q2, cursor pointer")}document.body.style.cursor="pointer";q2Text.setTextFill("white");textLayer.draw()});q2Text.on("mouseout",function(){if(debug==1){console.log("MouseOut q2, cursor default")}document.body.style.cursor="default";q2Text.setTextFill("#FF3100");textLayer.draw()});textLayer.add(q2Text);textLayer.draw();q2Text.transitionTo({opacity:.75,duration:2});textLayer.moveToTop();textLayer.draw();log("Function askContinue Ended R995")}function askFinal(){log("Function askFinal Started");textLayer.removeChildren();textLayer.draw();var a="Eind level vrij gespeeld";var b="Nu spelen";var c="verder met rondlopen";var d=new Kinetic.Rect({x:0,y:0,width:950,height:500,fill:"grey",stroke:"black",strokeWidth:1,opacity:0});textLayer.add(d);textLayer.draw();d.transitionTo({opacity:.75,duration:1});askText=new Kinetic.Text({x:stage.getWidth()/4-100,y:stage.getHeight()/4,text:a,padding:15,stroke:"#ecede9",strokeWidth:5,fill:{start:{x:0,y:0},end:{x:200,y:200},colorStops:[0,"#4F2009",1,"black"]},fontSize:35,fontFamily:"Calibri",textFill:"White",align:"center",opacity:0,cornerRadius:20});textLayer.add(askText);textLayer.draw();askText.transitionTo({opacity:.75,duration:2});q1Text=new Kinetic.Text({x:stage.getWidth()/4-100,y:stage.getHeight()/4*3-150,text:b,padding:15,stroke:"#ecede9",strokeWidth:5,fill:{start:{x:0,y:0},end:{x:200,y:200},colorStops:[0,"#4F2009",1,"black"]},fontSize:25,fontFamily:"Calibri",textFill:"#74FF00",align:"center",opacity:0,cornerRadius:20});q1Text.on("mouseup",function(){if(debug==1){console.log("Mouseup q1")}stage.reset();initFinal()});q1Text.on("mouseover",function(){if(debug==1){console.log("MouseOver q1, cursor pointer")}document.body.style.cursor="pointer";q1Text.setTextFill("white");textLayer.draw()});q1Text.on("mouseout",function(){if(debug==1){console.log("MouseOut q1, cursor default")}document.body.style.cursor="default";q1Text.setTextFill("#74FF00");textLayer.draw()});textLayer.add(q1Text);textLayer.draw();q1Text.transitionTo({opacity:.75,duration:2});q2Text=new Kinetic.Text({x:stage.getWidth()/4*3-250,y:stage.getHeight()/4*3-150,text:c,padding:15,stroke:"#ecede9",strokeWidth:5,fill:{start:{x:0,y:0},end:{x:200,y:200},colorStops:[0,"#4F2009",1,"black"]},fontSize:25,fontFamily:"Calibri",textFill:"#FF3100",align:"center",opacity:0,cornerRadius:20});q2Text.on("mouseup",function(){if(debug==1){console.log("Mouseup q2")}setRoamLocation(10)});q2Text.on("mouseover",function(){if(debug==1){console.log("MouseOver q2, cursor pointer")}document.body.style.cursor="pointer";q2Text.setTextFill("white");textLayer.draw()});q2Text.on("mouseout",function(){if(debug==1){console.log("MouseOut q2, cursor default")}document.body.style.cursor="default";q2Text.setTextFill("#FF3100");textLayer.draw()});textLayer.add(q2Text);textLayer.draw();q2Text.transitionTo({opacity:.75,duration:2});textLayer.moveToTop();textLayer.draw();log("Function askFinal Ended R1368")}function levelFirst(){onScreen=1;var a="Dit level is gesloten, haal eerst de onderliggende levels.";var b=new Kinetic.Rect({x:0,y:0,width:950,height:500,fill:"grey",stroke:"black",strokeWidth:1,opacity:0});textLayer.add(b);textLayer.draw();b.transitionTo({opacity:.75,duration:1});b.on("mouseup",function(){textLayer.remove(b);textLayer.remove(askText);textLayer.draw();onScreen=0});askText=new Kinetic.Text({x:0,y:stage.getHeight()/4,text:a,padding:15,stroke:"#ecede9",strokeWidth:5,fill:{start:{x:0,y:0},end:{x:200,y:200},colorStops:[0,"#4F2009",1,"black"]},fontSize:30,fontFamily:"Calibri",textFill:"#FF4505",align:"center",opacity:0,cornerRadius:20});textLayer.add(askText);textLayer.draw();askText.transitionTo({opacity:.75,duration:2});askText.on("mouseup",function(){textLayer.remove(b);textLayer.remove(askText);textLayer.draw();onScreen=0});setTimeout(function(){if(onScreen==1){textLayer.remove(b);textLayer.remove(askText);textLayer.draw()}},7500)}function initState01(){stage.add(backgroundLayer);stage.add(characterLayer);stage.add(textLayer);if(debug==1)console.log("initializing State 01(AnyState)");if(debug==1)console.log("Set collision field");a_X1=610;a_Y1=-23;a_X2=860;a_Y2=112;backgroundImg=new Image;backgroundImg.src="assets/bg.png";var a=new Image;a.src="assets/sintlucas.png";dragHereImg=new Image;dragHereImg.src="assets/drag_here.png";dragAbleImg=new Image;dragAbleImg.src="assets/button.png";backgroundImg.onload=function(){background=new Kinetic.Image({x:0,y:0,image:backgroundImg,draggable:false,opacity:0});backgroundLayer.add(background);background.transitionTo({opacity:1,duration:2});var a=new Image;a.src="assets/sintlucas.png";var b=new Kinetic.Image({x:0,y:0,image:a,draggable:false,opacity:0});backgroundLayer.add(b);backgroundLayer.draw();b.transitionTo({x:50,y:10,opacity:1,duration:3})};dragHereImg.onload=function(){dragHere=new Kinetic.Image({x:675,y:100,image:dragHereImg,draggable:false,opacity:0});characterLayer.add(dragHere);dragHere.transitionTo({opacity:.8,duration:3})};dragAbleImg.onload=function(){dragAble=new Kinetic.Image({x:75,y:280,image:dragAbleImg,draggable:true,opacity:0});characterLayer.add(dragAble);dragAble.on("dragstart",function(){b.moveToTop();dragAble.moveToTop();characterLayer.draw();b.setOpacity(.5);if(debug==1){console.log("Drag Start 'dragAble image'")}});dragAble.on("dragmove",function(){document.body.style.cursor="pointer";if(debug==1){console.log("'dragAble' position x:"+dragAble.getX()+"Y: "+dragAble.getY())}});dragAble.on("dragend",function(){if(debug==1)console.log("Drag Ended 'dragAble'");document.body.style.cursor="default";b.setOpacity(0);characterLayer.draw();if(dragAble.getX()>=a_X1&&dragAble.getX()<=a_X2&&dragAble.getY()>=a_Y1&&dragAble.getY()<=a_Y2){stage.reset();initState02()}else if(dragAble.getX()>815){dragAble.setX(800);characterLayer.draw()}else if(dragAble.getX()<0){dragAble.setX(10);characterLayer.draw()}else if(dragAble.getY()>290){dragAble.setY(280);characterLayer.draw()}else if(dragAble.getY()<0){dragAble.setY(10);characterLayer.draw()}});dragAble.transitionTo({opacity:1,x:125,duration:1})};var b=new Kinetic.Rect({x:675,y:100,width:200,height:50,fill:"orange",opacity:0});characterLayer.add(b);if(debug==1){console.log("Done Loading State 01(Any State)")}}function initState02(){if(debug==1)console.log("initializing State 02(Splash)");var a=new Image;a.src="assets/createc.png";a.onload=function(){background=new Kinetic.Image({x:0,y:0,image:a,draggable:false,opacity:0});backgroundLayer.add(background);stage.add(backgroundLayer);textLayer.moveToTop();background.transitionTo({opacity:1,duration:2})};if(debug==1){var b=new Kinetic.Text({x:10,y:475,text:"Alpha - "+version,fontSize:10,fontFamily:"Lucida Console",textFill:"White",opacity:0});textLayer.add(b);stage.add(textLayer);b.transitionTo({opacity:1,duration:2})}else{var b=new Kinetic.Text({x:10,y:475,text:"Debugging off",fontSize:10,fontFamily:"Lucida Console",textFill:"White",opacity:0});textLayer.add(b);stage.add(textLayer);b.transitionTo({opacity:1,duration:2})}setTimeout(function(){background.transitionTo({opacity:1,duration:1});document.body.style.cursor="default";backgroundLayer.removeChildren();stage.reset();initState03()},5e3);if(debug==1)console.log("Done Loading State02, and Call Function 'initState03' after 5 seconds")}function initState03(){if(debug==1)console.log("initializing State 03(Menu)");stage.add(backgroundLayer);stage.add(textLayer);var a=new Image;a.src="assets/bg.png";a.onload=function(){background=new Kinetic.Image({x:0,y:0,image:a,draggable:false,opacity:0});backgroundLayer.add(background);stage.add(backgroundLayer);textLayer.moveToTop();background.transitionTo({opacity:1,duration:1});var b=new Image;b.src="assets/sintlucas.png";var c=new Kinetic.Image({x:0,y:0,image:b,draggable:false,opacity:0});backgroundLayer.add(c);backgroundLayer.draw();c.transitionTo({x:50,y:10,opacity:1,duration:3});log("underGame play");log("underGame currentTime is 0");underGame.currentTime=0;underGame.play();setMenuText()}}function setMenuText(){var a=new Kinetic.Text({x:850,y:50,text:"HoofdMenu",fontSize:30,fontFamily:"Segoe Script",textFill:"Orange",opacity:0});textLayer.add(a);a.transitionTo({x:650,opacity:1,duration:2});var b=new Kinetic.Text({x:850,y:120,text:"Play!",fontSize:25,fontFamily:"Segoe Script",textFill:"red",opacity:0});b.on("mouseup",function(){if(debug==1){console.log("Clicked Play, Go to Level 01")}stage.reset();initState06()});b.on("mouseover",function(){if(debug==1){console.log("MouseOver Play, cursor pointer")}document.body.style.cursor="pointer"});b.on("mouseout",function(){if(debug==1){console.log("MouseOut Play, cursor default")}document.body.style.cursor="default"});textLayer.add(b);b.transitionTo({x:735,opacity:1,duration:2});var c=new Kinetic.Text({x:850,y:170,text:"Credits",fontSize:25,fontFamily:"Segoe Script",textFill:"white",opacity:0});c.on("mouseup tap",function(){if(debug==1){console.log("Clicked Play, Go to Credits(State05)")}stage.reset();initState05()});c.on("mouseover",function(){if(debug==1){console.log("MouseOver Credits, cursor pointer")}document.body.style.cursor="pointer"});c.on("mouseout",function(){if(debug==1){console.log("MouseOut Credits, cursor default")}document.body.style.cursor="default"});textLayer.add(c);c.transitionTo({x:735,opacity:1,duration:2});var d=new Kinetic.Text({x:850,y:220,text:"Exit",fontSize:25,fontFamily:"Segoe Script",textFill:"white",opacity:0});d.on("mouseup tap",function(){if(debug==1){console.log("Clicked Exit, Go to Credits(State05)")}stage.reset();initState01()});d.on("mouseover",function(){if(debug==1){console.log("MouseOver Exit, cursor pointer")}document.body.style.cursor="pointer"});d.on("mouseout",function(){if(debug==1){console.log("MouseOut Exit, cursor default")}document.body.style.cursor="default"});textLayer.add(d);stage.add(textLayer);d.transitionTo({x:735,opacity:1,duration:2});console.log("Done Loading, State03")}function initState05(){underGame.pause();log("<AUDIO> reset Credits time and volume");credits.currentTime=0;credits.volume=1;log("<AUDIO> play credits");credits.play();stage.add(textLayer);stage.add(characterLayer);stage.add(secondTextLayer);if(debug==1)console.log("initializing State 05(Credits)");var a=new Image;a.src="assets/bg.png";a.onload=function(){background=new Kinetic.Image({x:0,y:0,image:a,draggable:false,opacity:0});backgroundLayer.add(background);stage.add(backgroundLayer);characterLayer.moveToTop();textLayer.moveToTop();secondTextLayer.moveToTop();background.transitionTo({opacity:1,duration:2})};aText=new Kinetic.Text({x:600,y:15,text:"Credits",fontSize:50,fontFamily:"Calibri",textFill:"white",align:"center",fontStyle:"italic",shadow:{color:"black",blur:1,offset:[7.5,7.5],opacity:0},opacity:0});secondTextLayer.add(aText);secondTextLayer.draw();aText.transitionTo({opacity:1,duration:2});secondTextLayer.moveToTop();setTimeout(function(){characterLayer.removeChildren();a.src="assets/rens_verspagen.png";setCText(600,200,30,"Project Lead");setCText(600,250,20,"Rens Verspagen");characterLayer.moveToTop();secondTextLayer.moveToTop()},5e3);setTimeout(function(){textLayer.removeChildren();setCText(600,200,30,"Lead Programming");setCText(600,250,20,"Arjan Kuijpers")},1e4);setTimeout(function(){textLayer.removeChildren();characterLayer.moveToTop();setCText(600,200,30,"2D Art");setCText(600,250,20,"Rens Verspagen")},15e3);setTimeout(function(){textLayer.removeChildren();a.src="assets/max_linssen.png";setCText(600,200,30,"3D Art");setCText(600,250,20,"Max Linssen");characterLayer.moveToTop();secondTextLayer.moveToTop()},2e4);setTimeout(function(){textLayer.removeChildren();setCText(600,200,30,"Character Design");setCText(600,250,20,"Rens Verspagen")},25e3);setTimeout(function(){textLayer.removeChildren();a.src="assets/arjan_kuijpers.png";setCText(550,200,30,"AI / Gameplay &\n  Core system design");setCText(600,300,20,"Arjan Kuijpers");secondTextLayer.moveToTop()},3e4);setTimeout(function(){a.src="assets/bg.png";textLayer.removeChildren();setCText(550,200,30,"Thank you for playing");setCText(600,250,25,"Createc")},35e3);setTimeout(function(){credits.volume-=.1},39e3);setTimeout(function(){credits.volume-=.1},4e4);setTimeout(function(){credits.volume-=.1},41e3);setTimeout(function(){credits.volume-=.1},42e3);setTimeout(function(){credits.volume-=.2},43e3);setTimeout(function(){credits.volume-=.2},44e3);setTimeout(function(){credits.volume-=.1},45e3);setTimeout(function(){log("<AUDIO> pause credits");credits.pause();log("Reset Stage");stage.reset();log("Init State01");initState01()},45e3);console.log("Done Loading, State05(Credits)")}function initState06(){stage.add(backgroundLayer);stage.add(characterLayer);stage.add(textLayer);if(debug==1){console.log("initializing State 06 (Tutorial)")}var a=new Image;a.src="assets/createc.png";var b=new Image;b.src="assets/button.png";a.onload=function(){background=new Kinetic.Image({x:0,y:0,image:a,draggable:false,opacity:0});backgroundLayer.add(background);backgroundLayer.draw();textLayer.moveToTop();background.transitionTo({opacity:1,duration:2})};b.onload=function(){con=new Kinetic.Image({x:0,y:0,image:b,draggable:false,opacity:0});con.on("mouseup",function(){if(debug==1){console.log("Clicked continue, skip = 1")}skip=1;textLayer.remove(con);setSText(10,20,15,"Tutorial overgeslagen")});textLayer.add(con);textLayer.draw();textLayer.moveToTop();con.transitionTo({opacity:1,duration:2})};if(debug==1){console.log("Done Loading, State06(Tutorial)")}if(debug==1){console.log("Start Text Messages")}setText(150,350,"Welkom, \n Nu volgt eerst een tutorial. \n\n Klik op de knop hierboven om over te slaan.\n Veel plezier namens Createc.");if(debug==1)console.log("Text 'one' has been drawn");setTimeout(function(){log("Skip timer expired");if(skip==0){setTimeout(function(){textLayer.removeChildren();textLayer.draw();a.src="assets/mbg.png";if(debug==1){console.log("Welkom01 bg geladen (vervangen voor Createc)")}setText(200,300,"Loop door het gebouw of gebruik de map.");textLayer.draw();setAchievement(2);if(debug==1){console.log("Text 'three' has been drawn")}},1e4);setTimeout(function(){textLayer.removeChildren();textLayer.draw();setText(400,400,"beantwoord de vragen juist en score zo hoog mogenlijk.");textLayer.draw();if(debug==1){console.log("Text '4' has been drawn")}},15e3);setTimeout(function(){textLayer.removeChildren();textLayer.draw();setText(400,250,"Open alle levels en ga naar het eind level");textLayer.draw();log("Text 'Five' has been drawn")},2e4);setTimeout(function(){stage.reset();initRoam(10)},25e3)}else{stage.reset();initRoam(10)}},1e4)}function initState07(){stage.add(textLayer);stage.add(secondTextLayer);stage.add(characterLayer);stage.add(hudLayer);if(debug==1)console.log("initializing State 07(Level Select)");log("Set wallpaper");var a=new Image;a.src="assets/bg.png";log("Set schoolimg");var b=new Image;b.src="assets/school.png";a.onload=function(){background=new Kinetic.Image({x:0,y:0,image:a,draggable:false,opacity:0});backgroundLayer.add(background);stage.add(backgroundLayer);characterLayer.moveToTop();textLayer.moveToTop();hudLayer.moveToTop();background.transitionTo({opacity:1,duration:2})};b.onload=function(){school=new Kinetic.Image({x:0,y:20,image:b,draggable:false,opacity:0});characterLayer.add(school);characterLayer.draw();characterLayer.moveToTop();textLayer.moveToTop();hudLayer.moveToTop();school.transitionTo({opacity:1,duration:2});setSText(350,10,35,"Selecteer een level");setBText(750,10,15,"Loop vrij rond, klik hier")};var c=new Kinetic.Polygon({points:[103,308,84,220,114,181,316,202,293,273,299,319],fill:"#00D2FF",stroke:"blue",strokeWidth:1,opacity:.3});if(progress[1]>=75){c.setFill("#FF8E00")}c.on("mouseover",function(){c.transitionTo({opacity:.6,duration:1});if(progress[1]>=75){setSelectText("Level 1 (Voltooid: "+progress[1]+"%)")}else{setSelectText("Level 1 ("+progress[1]+"%)")}});c.on("mouseout",function(){c.transitionTo({opacity:.3,duration:1});secondTextLayer.removeChildren()});c.on("mouseup",function(){stage.reset();initLevel01()});var d=new Kinetic.Polygon({points:[299,324,294,274,315,208,324,207,326,216,346,219,355,210,376,211,376,221,662,241,663,287,660,305,591,301,592,287,550,284,551,297,492,295,491,302,488,303,482,335,363,327,355,344,340,350,325,350,316,341,313,325],fill:"#FF2300",stroke:"red",strokeWidth:1,opacity:.3});d.on("mouseover",function(){d.transitionTo({opacity:.6,duration:1});if(progress[2]>=75){d.setFill("#FF8E00");setSelectText("Level 2 (Voltooid: "+progress[2]+"%)")}else{setSelectText("Level 2 ("+progress[2]+"%)")}});d.on("mouseout",function(){d.transitionTo({opacity:.3,duration:1});secondTextLayer.removeChildren()});d.on("mouseup",function(){stage.reset();initLevel02()});var e=new Kinetic.Polygon({points:[470,427,471,388,479,336,492,297,551,298,551,286,589,288,589,302,797,318,808,360,789,443,715,441,714,454,686,451,684,435,589,428,586,429,580,437,470,429],fill:"#FFD100",stroke:"yellow",strokeWidth:1,opacity:.3});e.on("mouseover",function(){e.transitionTo({opacity:.6,duration:1});if(statusLevel[3]==2)setSelectText("Level 3 (Op slot)");else if(statusLevel[3]==4){e.setFill("#FF8E00");setSelectText("Level 3 (Voltooid: "+progress[3]+"%)")}else{setSelectText("Level 3 ("+progress[3]+"%)")}});e.on("mouseout",function(){e.transitionTo({opacity:.3,duration:1});secondTextLayer.removeChildren()});e.on("mouseup",function(){stage.reset();initLevel03()});var f=new Kinetic.Polygon({points:[315,142,368,52,439,55,441,135,406,210,325,204],fill:"#92EC00",stroke:"green",strokeWidth:1,opacity:.3});f.on("mouseover",function(){f.transitionTo({opacity:.6,duration:1});if(statusLevel[4]==2)setSelectText("Level 4 (Op slot)");else if(statusLevel==4){f.setFill("#FF8E00");setSelectText("Level 4 (Voltooid: "+progress[4]+"%)")}else{setSelectText("Level 4 ("+progress[4]+"%)")}});f.on("mouseout",function(){f.transitionTo({opacity:.3,duration:1});secondTextLayer.removeChildren()});f.on("mouseup",function(){stage.reset();initLevel04()});if(statusLevel[3]==2){e.setFill("#585858");e.setStroke("grey");e.off("mouseup")}if(statusLevel[4]==2){f.setFill("#585858");f.setStroke("grey");f.off("mouseup")}var g=new Kinetic.Group;g.add(c);g.add(d);g.add(e);g.add(f);g.setY(g.getY()+20);hudLayer.add(g);hudLayer.draw();hudLayer.moveToTop();console.log("Done Loading, State07(Level Select)")}var Kinetic={};Kinetic.Filters={},Kinetic.Plugins={},Kinetic.Global={BUBBLE_WHITELIST:["mousedown","mousemove","mouseup","mouseover","mouseout","click","dblclick","touchstart","touchmove","touchend","tap","dbltap","dragstart","dragmove","dragend"],BUFFER_WHITELIST:["fill","stroke","textFill","textStroke"],BUFFER_BLACKLIST:["shadow"],stages:[],idCounter:0,tempNodes:{},shapes:{},maxDragTimeInterval:20,drag:{moving:!1,offset:{x:0,y:0},lastDrawTime:0},warn:function(a){console&&console.warn&&console.warn("Kinetic warning: "+a)},extend:function(a,b){for(var c in b.prototype)c in a.prototype||(a.prototype[c]=b.prototype[c])},_pullNodes:function(a){var b=this.tempNodes;for(var c in b){var d=b[c];d.getStage()!==undefined&&d.getStage()._id===a._id&&(a._addId(d),a._addName(d),this._removeTempNode(d))}},_addTempNode:function(a){this.tempNodes[a._id]=a},_removeTempNode:function(a){delete this.tempNodes[a._id]}},Kinetic.Transition=function(a,b){function c(a,b,e,f){for(var g in a)g!=="duration"&&g!=="easing"&&g!=="callback"&&(Kinetic.Type._isObject(a[g])?(e[g]={},c(a[g],b[g],e[g],f)):d._add(d._getTween(b,g,a[g],e,f)))}this.node=a,this.config=b,this.tweens=[];var d=this,e={};c(b,a.attrs,e,e);var f=0;for(var g=0;g<this.tweens.length;g++){var h=this.tweens[g];h.onFinished=function(){f++,f>=d.tweens.length&&d.onFinished()}}},Kinetic.Transition.prototype={start:function(){for(var a=0;a<this.tweens.length;a++)this.tweens[a].start()},stop:function(){for(var a=0;a<this.tweens.length;a++)this.tweens[a].stop()},resume:function(){for(var a=0;a<this.tweens.length;a++)this.tweens[a].resume()},_onEnterFrame:function(){for(var a=0;a<this.tweens.length;a++)this.tweens[a].onEnterFrame()},_add:function(a){this.tweens.push(a)},_getTween:function(a,b,c,d,e){var f=this.config,g=this.node,h=f.easing;h===undefined&&(h="linear");var i=new Kinetic.Tween(g,function(a){d[b]=a,g.setAttrs(e)},Kinetic.Tweens[h],a[b],c,f.duration);return i}},Kinetic.Filters.Grayscale=function(a){var b=a.data;for(var c=0;c<b.length;c+=4){var d=.34*b[c]+.5*b[c+1]+.16*b[c+2];b[c]=d,b[c+1]=d,b[c+2]=d}},Kinetic.Type={_isElement:function(a){return!!a&&a.nodeType==1},_isFunction:function(a){return!!(a&&a.constructor&&a.call&&a.apply)},_isObject:function(a){return!!a&&a.constructor==Object},_isArray:function(a){return Object.prototype.toString.call(a)=="[object Array]"},_isNumber:function(a){return Object.prototype.toString.call(a)=="[object Number]"},_isString:function(a){return Object.prototype.toString.call(a)=="[object String]"},_hasMethods:function(a){var b=[];for(var c in a)this._isFunction(a[c])&&b.push(c);return b.length>0},_getXY:function(a){if(this._isNumber(a))return{x:a,y:a};if(this._isArray(a)){if(a.length===1){var b=a[0];if(this._isNumber(b))return{x:b,y:b};if(this._isArray(b))return{x:b[0],y:b[1]};if(this._isObject(b))return b}else if(a.length>=2)return{x:a[0],y:a[1]}}else if(this._isObject(a))return a;return{x:0,y:0}},_getSize:function(a){if(this._isNumber(a))return{width:a,height:a};if(this._isArray(a))if(a.length===1){var b=a[0];if(this._isNumber(b))return{width:b,height:b};if(this._isArray(b)){if(b.length>=4)return{width:b[2],height:b[3]};if(b.length>=2)return{width:b[0],height:b[1]}}else if(this._isObject(b))return b}else{if(a.length>=4)return{width:a[2],height:a[3]};if(a.length>=2)return{width:a[0],height:a[1]}}else if(this._isObject(a))return a;return{width:0,height:0}},_getPoints:function(a){if(a===undefined)return[];if(this._isObject(a[0]))return a;var b=[];for(var c=0;c<a.length;c+=2)b.push({x:a[c],y:a[c+1]});return b},_getImage:function(a,b){if(!a)b(null);else if(this._isElement(a))b(a);else if(this._isString(a)){var c=new Image;c.onload=function(){b(c)},c.src=a}else if(a.data){var d=document.createElement("canvas");d.width=a.width,d.height=a.height;var e=d.getContext("2d");e.putImageData(a,0,0);var f=d.toDataURL(),c=new Image;c.onload=function(){b(c)},c.src=f}else b(null)},_rgbToHex:function(a,b,c){return((1<<24)+(a<<16)+(b<<8)+c).toString(16).slice(1)},_hexToRgb:function(a){var b=parseInt(a,16);return{r:b>>16&255,g:b>>8&255,b:b&255}},_getRandomColorKey:function(){var a=Math.round(Math.random()*255),b=Math.round(Math.random()*255),c=Math.round(Math.random()*255);return this._rgbToHex(a,b,c)}},Kinetic.Canvas=function(a,b){this.element=document.createElement("canvas"),this.context=this.element.getContext("2d"),this.element.width=a,this.element.height=b},Kinetic.Canvas.prototype={clear:function(){var a=this.getContext(),b=this.getElement();a.clearRect(0,0,b.width,b.height)},getElement:function(){return this.element},getContext:function(){return this.context},setWidth:function(a){this.element.width=a},setHeight:function(a){this.element.height=a},getWidth:function(){return this.element.width},getHeight:function(){return this.element.height},setSize:function(a,b){this.setWidth(a),this.setHeight(b)},toDataURL:function(a,b){try{return this.element.toDataURL(a,b)}catch(c){return this.element.toDataURL()}}},Kinetic.Tween=function(a,b,c,d,e,f){this._listeners=[],this.addListener(this),this.obj=a,this.propFunc=b,this.begin=d,this._pos=d,this.setDuration(f),this.isPlaying=!1,this._change=0,this.prevTime=0,this.prevPos=0,this.looping=!1,this._time=0,this._position=0,this._startTime=0,this._finish=0,this.name="",this.func=c,this.setFinish(e)},Kinetic.Tween.prototype={setTime:function(a){this.prevTime=this._time,a>this.getDuration()?this.looping?(this.rewind(a-this._duration),this.update(),this.broadcastMessage("onLooped",{target:this,type:"onLooped"})):(this._time=this._duration,this.update(),this.stop(),this.broadcastMessage("onFinished",{target:this,type:"onFinished"})):a<0?(this.rewind(),this.update()):(this._time=a,this.update())},getTime:function(){return this._time},setDuration:function(a){this._duration=a===null||a<=0?1e5:a},getDuration:function(){return this._duration},setPosition:function(a){this.prevPos=this._pos,this.propFunc(a),this._pos=a,this.broadcastMessage("onChanged",{target:this,type:"onChanged"})},getPosition:function(a){return a===undefined&&(a=this._time),this.func(a,this.begin,this._change,this._duration)},setFinish:function(a){this._change=a-this.begin},getFinish:function(){return this.begin+this._change},start:function(){this.rewind(),this.startEnterFrame(),this.broadcastMessage("onStarted",{target:this,type:"onStarted"})},rewind:function(a){this.stop(),this._time=a===undefined?0:a,this.fixTime(),this.update()},fforward:function(){this._time=this._duration,this.fixTime(),this.update()},update:function(){this.setPosition(this.getPosition(this._time))},startEnterFrame:function(){this.stopEnterFrame(),this.isPlaying=!0,this.onEnterFrame()},onEnterFrame:function(){this.isPlaying&&this.nextFrame()},nextFrame:function(){this.setTime((this.getTimer()-this._startTime)/1e3)},stop:function(){this.stopEnterFrame(),this.broadcastMessage("onStopped",{target:this,type:"onStopped"})},stopEnterFrame:function(){this.isPlaying=!1},continueTo:function(a,b){this.begin=this._pos,this.setFinish(a),this._duration!==undefined&&this.setDuration(b),this.start()},resume:function(){this.fixTime(),this.startEnterFrame(),this.broadcastMessage("onResumed",{target:this,type:"onResumed"})},yoyo:function(){this.continueTo(this.begin,this._time)},addListener:function(a){return this.removeListener(a),this._listeners.push(a)},removeListener:function(a){var b=this._listeners,c=b.length;while(c--)if(b[c]==a)return b.splice(c,1),!0;return!1},broadcastMessage:function(){var a=[];for(var b=0;b<arguments.length;b++)a.push(arguments[b]);var c=a.shift(),d=this._listeners,e=d.length;for(var b=0;b<e;b++)d[b][c]&&d[b][c].apply(d[b],a)},fixTime:function(){this._startTime=this.getTimer()-this._time*1e3},getTimer:function(){return(new Date).getTime()-this._time}},Kinetic.Tweens={"back-ease-in":function(a,b,c,d,e,f){var g=1.70158;return c*(a/=d)*a*((g+1)*a-g)+b},"back-ease-out":function(a,b,c,d,e,f){var g=1.70158;return c*((a=a/d-1)*a*((g+1)*a+g)+1)+b},"back-ease-in-out":function(a,b,c,d,e,f){var g=1.70158;return(a/=d/2)<1?c/2*a*a*(((g*=1.525)+1)*a-g)+b:c/2*((a-=2)*a*(((g*=1.525)+1)*a+g)+2)+b},"elastic-ease-in":function(a,b,c,d,e,f){var g=0;return a===0?b:(a/=d)==1?b+c:(f||(f=d*.3),!e||e<Math.abs(c)?(e=c,g=f/4):g=f/(2*Math.PI)*Math.asin(c/e),-(e*Math.pow(2,10*(a-=1))*Math.sin((a*d-g)*2*Math.PI/f))+b)},"elastic-ease-out":function(a,b,c,d,e,f){var g=0;return a===0?b:(a/=d)==1?b+c:(f||(f=d*.3),!e||e<Math.abs(c)?(e=c,g=f/4):g=f/(2*Math.PI)*Math.asin(c/e),e*Math.pow(2,-10*a)*Math.sin((a*d-g)*2*Math.PI/f)+c+b)},"elastic-ease-in-out":function(a,b,c,d,e,f){var g=0;return a===0?b:(a/=d/2)==2?b+c:(f||(f=d*.3*1.5),!e||e<Math.abs(c)?(e=c,g=f/4):g=f/(2*Math.PI)*Math.asin(c/e),a<1?-.5*e*Math.pow(2,10*(a-=1))*Math.sin((a*d-g)*2*Math.PI/f)+b:e*Math.pow(2,-10*(a-=1))*Math.sin((a*d-g)*2*Math.PI/f)*.5+c+b)},"bounce-ease-out":function(a,b,c,d){return(a/=d)<1/2.75?c*7.5625*a*a+b:a<2/2.75?c*(7.5625*(a-=1.5/2.75)*a+.75)+b:a<2.5/2.75?c*(7.5625*(a-=2.25/2.75)*a+.9375)+b:c*(7.5625*(a-=2.625/2.75)*a+.984375)+b},"bounce-ease-in":function(a,b,c,d){return c-Kinetic.Tweens["bounce-ease-out"](d-a,0,c,d)+b},"bounce-ease-in-out":function(a,b,c,d){return a<d/2?Kinetic.Tweens["bounce-ease-in"](a*2,0,c,d)*.5+b:Kinetic.Tweens["bounce-ease-out"](a*2-d,0,c,d)*.5+c*.5+b},"ease-in":function(a,b,c,d){return c*(a/=d)*a+b},"ease-out":function(a,b,c,d){return-c*(a/=d)*(a-2)+b},"ease-in-out":function(a,b,c,d){return(a/=d/2)<1?c/2*a*a+b:-c/2*(--a*(a-2)-1)+b},"strong-ease-in":function(a,b,c,d){return c*(a/=d)*a*a*a*a+b},"strong-ease-out":function(a,b,c,d){return c*((a=a/d-1)*a*a*a*a+1)+b},"strong-ease-in-out":function(a,b,c,d){return(a/=d/2)<1?c/2*a*a*a*a*a+b:c/2*((a-=2)*a*a*a*a+2)+b},linear:function(a,b,c,d){return c*a/d+b}},Kinetic.Transform=function(){this.m=[1,0,0,1,0,0]},Kinetic.Transform.prototype={translate:function(a,b){this.m[4]+=this.m[0]*a+this.m[2]*b,this.m[5]+=this.m[1]*a+this.m[3]*b},scale:function(a,b){this.m[0]*=a,this.m[1]*=a,this.m[2]*=b,this.m[3]*=b},rotate:function(a){var b=Math.cos(a),c=Math.sin(a),d=this.m[0]*b+this.m[2]*c,e=this.m[1]*b+this.m[3]*c,f=this.m[0]*-c+this.m[2]*b,g=this.m[1]*-c+this.m[3]*b;this.m[0]=d,this.m[1]=e,this.m[2]=f,this.m[3]=g},getTranslation:function(){return{x:this.m[4],y:this.m[5]}},multiply:function(a){var b=this.m[0]*a.m[0]+this.m[2]*a.m[1],c=this.m[1]*a.m[0]+this.m[3]*a.m[1],d=this.m[0]*a.m[2]+this.m[2]*a.m[3],e=this.m[1]*a.m[2]+this.m[3]*a.m[3],f=this.m[0]*a.m[4]+this.m[2]*a.m[5]+this.m[4],g=this.m[1]*a.m[4]+this.m[3]*a.m[5]+this.m[5];this.m[0]=b,this.m[1]=c,this.m[2]=d,this.m[3]=e,this.m[4]=f,this.m[5]=g},invert:function(){var a=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]),b=this.m[3]*a,c=-this.m[1]*a,d=-this.m[2]*a,e=this.m[0]*a,f=a*(this.m[2]*this.m[5]-this.m[3]*this.m[4]),g=a*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);this.m[0]=b,this.m[1]=c,this.m[2]=d,this.m[3]=e,this.m[4]=f,this.m[5]=g},getMatrix:function(){return this.m}},Kinetic.Animation=function(a){a||(a={});for(var b in a)this[b]=a[b];this.frame={time:0,timeDiff:0,lastTime:(new Date).getTime()},this.id=Kinetic.Animation.animIdCounter++},Kinetic.Animation.prototype={start:function(){this.stop(),this.frame.lastTime=(new Date).getTime(),Kinetic.Animation._addAnimation(this),Kinetic.Animation._handleAnimation()},stop:function(){Kinetic.Animation._removeAnimation(this)}},Kinetic.Animation.animations=[],Kinetic.Animation.animIdCounter=0,Kinetic.Animation.animRunning=!1,Kinetic.Animation._addAnimation=function(a){this.animations.push(a)},Kinetic.Animation._removeAnimation=function(a){var b=a.id,c=this.animations;for(var d=0;d<c.length;d++)if(c[d].id===b)return this.animations.splice(d,1),!1},Kinetic.Animation._updateFrameObject=function(a){var b=(new Date).getTime();a.frame.timeDiff=b-a.frame.lastTime,a.frame.lastTime=b,a.frame.time+=a.frame.timeDiff},Kinetic.Animation._runFrames=function(){var a={};for(var b=0;b<this.animations.length;b++){var c=this.animations[b];this._updateFrameObject(c),c.node&&c.node._id!==undefined&&(a[c.node._id]=c.node),c.func&&c.func(c.frame)}for(var d in a)a[d].draw()},Kinetic.Animation._animationLoop=function(){if(this.animations.length>0){this._runFrames();var a=this;requestAnimFrame(function(){a._animationLoop()})}else this.animRunning=!1},Kinetic.Animation._handleAnimation=function(){var a=this;this.animRunning||(this.animRunning=!0,a._animationLoop())},requestAnimFrame=function(a){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,1e3/60)}}(),Kinetic.Node=function(a){this._nodeInit(a)},Kinetic.Node.prototype={_nodeInit:function(a){this.defaultNodeAttrs={visible:!0,listening:!0,name:undefined,opacity:1,x:0,y:0,scale:{x:1,y:1},rotation:0,offset:{x:0,y:0},dragConstraint:"none",dragBounds:{},draggable:!1},this.setDefaultAttrs(this.defaultNodeAttrs),this.eventListeners={},this.transAnim=new Kinetic.Animation,this.setAttrs(a),this.on("draggableChange.kinetic",function(){this._onDraggableChange()});var b=this;this.on("idChange.kinetic",function(a){var c=b.getStage();c&&(c._removeId(a.oldVal),c._addId(b))}),this.on("nameChange.kinetic",function(a){var c=b.getStage();c&&(c._removeName(a.oldVal,b._id),c._addName(b))}),this._onDraggableChange()},on:function(a,b){var c=a.split(" ");for(var d=0;d<c.length;d++){var e=c[d],f=e,g=f.split("."),h=g[0],i=g.length>1?g[1]:"";this.eventListeners[h]||(this.eventListeners[h]=[]),this.eventListeners[h].push({name:i,handler:b})}},off:function(a){var b=a.split(" ");for(var c=0;c<b.length;c++){var d=b[c],e=d,f=e.split("."),g=f[0];if(this.eventListeners[g]&&f.length>1){var h=f[1];for(var i=0;i<this.eventListeners[g].length;i++)if(this.eventListeners[g][i].name===h){this.eventListeners[g].splice(i,1);if(this.eventListeners[g].length===0){delete this.eventListeners[g];break}i--}}else delete this.eventListeners[g]}},getAttrs:function(){return this.attrs},setDefaultAttrs:function(a){this.attrs===undefined&&(this.attrs={});if(a)for(var b in a)this.attrs[b]===undefined&&(this.attrs[b]=a[b])},setAttrs:function(a){var b=Kinetic.Type,c=this;if(a!==undefined){function d(a,e,f){for(var g in e){var h=e[g],i=a[g];f===0&&c._fireBeforeChangeEvent(g,i,h),a[g]===undefined&&h!==undefined&&(a[g]={});if(b._isObject(h)&&!b._isArray(h)&&!b._isElement(h)&&!b._hasMethods(h))Kinetic.Type._isObject(a[g])||(a[g]={}),d(a[g],h,f+1);else switch(g){case"radius":if(Kinetic.Type._isNumber(h))c._setAttr(a,g,h);else{var j=b._getXY(h);c._setAttr(a[g],"x",j.x),c._setAttr(a[g],"y",j.y)}break;case"rotationDeg":c._setAttr(a,"rotation",e[g]*Math.PI/180),g="rotation";break;case"offset":var k=b._getXY(h);c._setAttr(a[g],"x",k.x),c._setAttr(a[g],"y",k.y);break;case"scale":var k=b._getXY(h);c._setAttr(a[g],"x",k.x),c._setAttr(a[g],"y",k.y);break;case"points":c._setAttr(a,g,b._getPoints(h));break;case"crop":var k=b._getXY(h),l=b._getSize(h);c._setAttr(a[g],"x",k.x),c._setAttr(a[g],"y",k.y),c._setAttr(a[g],"width",l.width),c._setAttr(a[g],"height",l.height);break;default:c._setAttr(a,g,h)}f===0&&c._fireChangeEvent(g,i,h)}}d(this.attrs,a,0)}},isVisible:function(){return this.attrs.visible&&this.getParent()&&!this.getParent().isVisible()?!1:this.attrs.visible},show:function(){this.setAttrs({visible:!0})},hide:function(){this.setAttrs({visible:!1})},getZIndex:function(){return this.index},getAbsoluteZIndex:function(){function a(c){var f=[];for(var g=0;g<c.length;g++){var h=c[g];e++,h.nodeType!=="Shape"&&(f=f.concat(h.getChildren())),h._id===d._id&&(g=c.length)}f.length>0&&f[0].getLevel()<=b&&a(f)}var b=this.getLevel(),c=this.getStage(),d=this,e=0;return d.nodeType!=="Stage"&&a(d.getStage().getChildren()),e},getLevel:function(){var a=0,b=this.parent;while(b)a++,b=b.parent;return a},setPosition:function(){var a=Kinetic.Type._getXY(Array.prototype.slice.call(arguments));this.setAttrs(a)},getPosition:function(){return{x:this.attrs.x,y:this.attrs.y}},getAbsolutePosition:function(){var a=this.getAbsoluteTransform(),b=this.getOffset();return a.translate(b.x,b.y),a.getTranslation()},setAbsolutePosition:function(){var a=Kinetic.Type._getXY(Array.prototype.slice.call(arguments)),b=this._clearTransform();this.attrs.x=b.x,this.attrs.y=b.y,delete b.x,delete b.y;var c=this.getAbsoluteTransform();c.invert(),c.translate(a.x,a.y),a={x:this.attrs.x+c.getTranslation().x,y:this.attrs.y+c.getTranslation().y},this.setPosition(a.x,a.y),this._setTransform(b)},move:function(){var a=Kinetic.Type._getXY(Array.prototype.slice.call(arguments)),b=this.getX(),c=this.getY();a.x!==undefined&&(b+=a.x),a.y!==undefined&&(c+=a.y),this.setAttrs({x:b,y:c})},getRotationDeg:function(){return this.attrs.rotation*180/Math.PI},rotate:function(a){this.setAttrs({rotation:this.getRotation()+a})},rotateDeg:function(a){this.setAttrs({rotation:this.getRotation()+a*Math.PI/180})},moveToTop:function(){var a=this.index;this.parent.children.splice(a,1),this.parent.children.push(this),this.parent._setChildrenIndices();if(this.nodeType==="Layer"){var b=this.getStage();b&&(b.content.removeChild(this.canvas.element),b.content.appendChild(this.canvas.element))}},moveUp:function(){var a=this.index;if(a<this.parent.getChildren().length-1){this.parent.children.splice(a,1),this.parent.children.splice(a+1,0,this),this.parent._setChildrenIndices();if(this.nodeType==="Layer"){var b=this.getStage();b&&(b.content.removeChild(this.canvas.element),this.index<b.getChildren().length-1?b.content.insertBefore(this.canvas.element,b.getChildren()[this.index+1].canvas.element):b.content.appendChild(this.canvas.element))}}},moveDown:function(){var a=this.index;if(a>0){this.parent.children.splice(a,1),this.parent.children.splice(a-1,0,this),this.parent._setChildrenIndices();if(this.nodeType==="Layer"){var b=this.getStage();b&&(b.content.removeChild(this.canvas.element),b.content.insertBefore(this.canvas.element,b.getChildren()[this.index+1].canvas.element))}}},moveToBottom:function(){var a=this.index;this.parent.children.splice(a,1),this.parent.children.unshift(this),this.parent._setChildrenIndices();if(this.nodeType==="Layer"){var b=this.getStage();b&&(b.content.removeChild(this.canvas.element),b.content.insertBefore(this.canvas.element,b.getChildren()[1].canvas.element))}},setZIndex:function(a){var b=this.index;this.parent.children.splice(b,1),this.parent.children.splice(a,0,this),this.parent._setChildrenIndices()},getAbsoluteOpacity:function(){var a=1,b=this;while(b.nodeType!=="Stage")a*=b.attrs.opacity,b=b.parent;return a},isDragging:function(){var a=Kinetic.Global;return a.drag.node&&a.drag.node._id===this._id&&a.drag.moving},moveTo:function(a){var b=this.parent;b.children.splice(this.index,1),b._setChildrenIndices(),a.children.push(this),this.index=a.children.length-1,this.parent=a,a._setChildrenIndices()},getParent:function(){return this.parent},getLayer:function(){return this.nodeType==="Layer"?this:this.getParent().getLayer()},getStage:function(){return this.nodeType!=="Stage"&&this.getParent()?this.getParent().getStage():this.nodeType==="Stage"?this:undefined},simulate:function(a){this._handleEvent(a,{})},transitionTo:function(a){var b=this.nodeType==="Stage"?this:this.getLayer(),c=this,d=new Kinetic.Transition(this,a);return this.transAnim.func=function(){d._onEnterFrame()},this.transAnim.node=b,d.onFinished=function(){c.transAnim.stop(),c.transAnim.node.draw(),a.callback&&a.callback()},d.start(),this.transAnim.start(),d},getAbsoluteTransform:function(){var a=new Kinetic.Transform,b=[],c=this.parent;b.unshift(this);while(c)b.unshift(c),c=c.parent;for(var d=0;d<b.length;d++){var e=b[d],f=e.getTransform();a.multiply(f)}return a},getTransform:function(){var a=new Kinetic.Transform;return(this.attrs.x!==0||this.attrs.y!==0)&&a.translate(this.attrs.x,this.attrs.y),this.attrs.rotation!==0&&a.rotate(this.attrs.rotation),(this.attrs.scale.x!==1||this.attrs.scale.y!==1)&&a.scale(this.attrs.scale.x,this.attrs.scale.y),this.attrs.offset&&(this.attrs.offset.x!==0||this.attrs.offset.y!==0)&&a.translate(-1*this.attrs.offset.x,-1*this.attrs.offset.y),a},clone:function(a){var b=this.shapeType||this.nodeType,c=new Kinetic[b](this.attrs);for(var d in this.eventListeners){var e=this.eventListeners[d];for(var f=0;f<e.length;f++){var g=e[f];g.name.indexOf("kinetic")<0&&(c.eventListeners[d]||(c.eventListeners[d]=[]),c.eventListeners[d].push(g))}}return c.setAttrs(a),c},toDataURL:function(a){var b=a&&a.mimeType?a.mimeType:null,c=a&&a.quality?a.quality:null,d;a&&a.width&&a.height?d=new Kinetic.Canvas(a.width,a.height):d=this.getStage().bufferCanvas;var e=d.getContext();return d.clear(),this._draw(d),d.toDataURL(b,c)},toImage:function(a){Kinetic.Type._getImage(this.toDataURL(a),function(b){a.callback(b)})},_clearTransform:function(){var a={x:this.attrs.x,y:this.attrs.y,rotation:this.attrs.rotation,scale:{x:this.attrs.scale.x,y:this.attrs.scale.y},offset:{x:this.attrs.offset.x,y:this.attrs.offset.y}};return this.attrs.x=0,this.attrs.y=0,this.attrs.rotation=0,this.attrs.scale={x:1,y:1},this.attrs.offset={x:0,y:0},a},_setTransform:function(a){for(var b in a)this.attrs[b]=a[b]},_fireBeforeChangeEvent:function(a,b,c){this._handleEvent("before"+a.toUpperCase()+"Change",{oldVal:b,newVal:c})},_fireChangeEvent:function(a,b,c){this._handleEvent(a+"Change",{oldVal:b,newVal:c})},_setAttr:function(a,b,c){c!==undefined&&(a===undefined&&(a={}),a[b]=c)},_listenDrag:function(){this._dragCleanup();var a=Kinetic.Global,b=this;this.on("mousedown.kinetic touchstart.kinetic",function(a){b._initDrag()})},_initDrag:function(){var a=Kinetic.Global,b=this.getStage(),c=b.getUserPosition();if(c){var d=this.getTransform().getTranslation(),e=this.getAbsoluteTransform().getTranslation(),f=this.getAbsolutePosition();a.drag.node=this,a.drag.offset.x=c.x-f.x,a.drag.offset.y=c.y-f.y,this.nodeType==="Stage"?b.dragAnim.node=this:b.dragAnim.node=this.getLayer(),b.dragAnim.start()}},_onDraggableChange:function(){if(this.attrs.draggable)this._listenDrag();else{this._dragCleanup();var a=this.getStage(),b=Kinetic.Global;a&&b.drag.node&&b.drag.node._id===this._id&&a._endDrag()}},_dragCleanup:function(){this.off("mousedown.kinetic"),this.off("touchstart.kinetic")},_handleEvent:function(a,b,c){this.nodeType==="Shape"&&(b.shape=this);var d=this.getStage(),e=this.eventListeners,f=!0;a==="mouseover"&&c&&this._id===c._id?f=!1:a==="mouseout"&&c&&this._id===c._id&&(f=!1);if(f){if(e[a]){var g=e[a];for(var h=0;h<g.length;h++)g[h].handler.apply(this,[b])}Kinetic.Global.BUBBLE_WHITELIST.indexOf(a)>=0&&!b.cancelBubble&&this.parent&&(c&&c.parent?this._handleEvent.call(this.parent,a,b,c.parent):this._handleEvent.call(this.parent,a,b))}},_draw:function(a){if(this.isVisible()&&(!a||a.name!=="buffer"||this.getListening())){this.__draw&&this.__draw(a);var b=this.children;if(b)for(var c=0;c<b.length;c++){var d=b[c];d.draw?d.draw(a):d._draw(a)}}}},Kinetic.Node.addSetters=function(a,b){for(var c=0;c<b.length;c++){var d=b[c];this._addSetter(a,d)}},Kinetic.Node.addGetters=function(a,b){for(var c=0;c<b.length;c++){var d=b[c];this._addGetter(a,d)}},Kinetic.Node.addGettersSetters=function(a,b){this.addSetters(a,b),this.addGetters(a,b)},Kinetic.Node._addSetter=function(a,b){var c=this,d="set"+b.charAt(0).toUpperCase()+b.slice(1);a.prototype[d]=function(){arguments.length==1?arg=arguments[0]:arg=Array.prototype.slice.call(arguments);var a={};a[b]=arg,this.setAttrs(a)}},Kinetic.Node._addGetter=function(a,b){var c=this,d="get"+b.charAt(0).toUpperCase()+b.slice(1);a.prototype[d]=function(a){return this.attrs[b]}},Kinetic.Node.addGettersSetters(Kinetic.Node,["x","y","scale","rotation","opacity","name","id","offset","draggable","dragConstraint","dragBounds","listening"]),Kinetic.Node.addSetters(Kinetic.Node,["rotationDeg"]),Kinetic.Container=function(a){this._containerInit(a)},Kinetic.Container.prototype={_containerInit:function(a){this.children=[],Kinetic.Node.call(this,a)},getChildren:function(){return this.children},removeChildren:function(){while(this.children.length>0)this.remove(this.children[0])},add:function(a){a._id=Kinetic.Global.idCounter++,a.index=this.children.length,a.parent=this,this.children.push(a);var b=a.getStage();if(!b)Kinetic.Global._addTempNode(a);else{b._addId(a),b._addName(a);var c=Kinetic.Global;c._pullNodes(b)}return this._add!==undefined&&this._add(a),this},remove:function(a){if(a&&a.index!==undefined&&this.children[a.index]._id==a._id){var b=this.getStage();b&&(b._removeId(a.getId()),b._removeName(a.getName(),a._id)),Kinetic.Global._removeTempNode(a),this.children.splice(a.index,1),this._setChildrenIndices();while(a.children&&a.children.length>0)a.remove(a.children[0]);a._remove!==undefined&&a._remove()}return this},get:function(a){var b=this.getStage(),c,d=a.slice(1);if(a.charAt(0)==="#")c=b.ids[d]!==undefined?[b.ids[d]]:[];else{if(a.charAt(0)!==".")return a==="Shape"||a==="Group"||a==="Layer"?this._getNodes(a):!1;c=b.names[d]!==undefined?b.names[d]:[]}var e=[];for(var f=0;f<c.length;f++){var g=c[f];this.isAncestorOf(g)&&e.push(g)}return e},isAncestorOf:function(a){if(this.nodeType==="Stage")return!0;var b=a.getParent();while(b){if(b._id===this._id)return!0;b=b.getParent()}return!1},getIntersections:function(){var a=Kinetic.Type._getXY(Array.prototype.slice.call(arguments)),b=[],c=this.get("Shape");for(var d=0;d<c.length;d++){var e=c[d];e.isVisible()&&e.intersects(a)&&b.push(e)}return b},_getNodes:function(a){function b(d){var e=d.getChildren();for(var f=0;f<e.length;f++){var g=e[f];g.nodeType===a?c.push(g):g.nodeType!=="Shape"&&b(g)}}var c=[];return b(this),c},_setChildrenIndices:function(){for(var a=0;a<this.children.length;a++)this.children[a].index=a}},Kinetic.Global.extend(Kinetic.Container,Kinetic.Node),Kinetic.Stage=function(a){this._initStage(a)},Kinetic.Stage.prototype={_initStage:function(a){this.setDefaultAttrs({width:400,height:200}),typeof a.container=="string"&&(a.container=document.getElementById(a.container)),Kinetic.Container.call(this,a),this._setStageDefaultProperties(),this._id=Kinetic.Global.idCounter++,this._buildDOM(),this._bindContentEvents(),this.on("widthChange.kinetic",function(){this._resizeDOM()}),this.on("heightChange.kinetic",function(){this._resizeDOM()});var b=Kinetic.Global;b.stages.push(this),this._addId(this),this._addName(this)},draw:function(){this._draw()},setSize:function(){var a=Kinetic.Type._getSize(Array.prototype.slice.call(arguments));this.setAttrs(a)},getSize:function(){return{width:this.attrs.width,height:this.attrs.height}},clear:function(){var a=this.children;for(var b=0;b<a.length;b++)a[b].clear()},toJSON:function(){function a(c){var d={};d.attrs={};for(var e in c.attrs){var f=c.attrs[e];!b._isFunction(f)&&!b._isElement(f)&&!b._hasMethods(f)&&(d.attrs[e]=f)}d.nodeType=c.nodeType,d.shapeType=c.shapeType;if(c.nodeType!=="Shape"){d.children=[];var g=c.getChildren();for(var h=0;h<g.length;h++){var i=g[h];d.children.push(a(i))}}return d}var b=Kinetic.Type;return JSON.stringify(a(this))},reset:function(){this.removeChildren(),this._setStageDefaultProperties(),this.setAttrs(this.defaultNodeAttrs)},load:function(a){function b(a,c){var d=c.children;if(d!==undefined)for(var e=0;e<d.length;e++){var f=d[e],g;f.nodeType==="Shape"?f.shapeType===undefined?g="Shape":g=f.shapeType:g=f.nodeType;var h=new Kinetic[g](f.attrs);a.add(h),b(h,f)}}this.reset();var c=JSON.parse(a);this.attrs=c.attrs,b(this,c),this.draw()},getMousePosition:function(a){return this.mousePos},getTouchPosition:function(a){return this.touchPos},getUserPosition:function(a){return this.getTouchPosition()||this.getMousePosition()},getContainer:function(){return this.attrs.container},getStage:function(){return this},getDOM:function(){return this.content},toDataURL:function(a){function b(e){var f=i[e],j=f.getCanvas().toDataURL(),k=new Image;k.onload=function(){h.drawImage(k,0,0),e<i.length-1?b(e+1):a.callback(g.toDataURL(c,d))},k.src=j}var c=a&&a.mimeType?a.mimeType:null,d=a&&a.quality?a.quality:null,e=a&&a.width?a.width:this.attrs.width,f=a&&a.height?a.height:this.attrs.height,g=new Kinetic.Canvas(e,f),h=g.getContext(),i=this.children;b(0)},toImage:function(a){this.toDataURL({callback:function(b){Kinetic.Type._getImage(b,function(b){a.callback(b)})}})},getIntersection:function(a){var b,c=this.getChildren();for(var d=c.length-1;d>=0;d--){var e=c[d],f=e.bufferCanvas.context.getImageData(Math.round(a.x),Math.round(a.y),1,1).data;if(f[3]===255){var g=Kinetic.Type._rgbToHex(f[0],f[1],f[2]);return b=Kinetic.Global.shapes[g],{shape:b,pixel:f}}if(f[0]>0||f[1]>0||f[2]>0||f[3]>0)return{pixel:f}}return null},_resizeDOM:function(){var a=this.attrs.width,b=this.attrs.height;this.content.style.width=a+"px",this.content.style.height=b+"px",this.bufferCanvas.setSize(a,b);var c=this.children;for(var d=0;d<c.length;d++){var e=c[d];e.getCanvas().setSize(a,b),e.bufferCanvas.setSize(a,b),e.draw()}},_add:function(a){a.canvas.setSize(this.attrs.width,this.attrs.height),a.bufferCanvas.setSize(this.attrs.width,this.attrs.height),a.draw(),this.content.appendChild(a.canvas.element)},_setUserPosition:function(a){a||(a=window.event),this._setMousePosition(a),this._setTouchPosition(a)},_bindContentEvents:function(){var a=Kinetic.Global,b=this,c=["mousedown","mousemove","mouseup","mouseout","touchstart","touchmove","touchend"];for(var d=0;d<c.length;d++){var e=c[d];(function(){var a=e;b.content.addEventListener(a,function(c){b["_"+a](c)},!1)})()}},_mouseout:function(a){this._setUserPosition(a);var b=Kinetic.Global,c=this.targetShape;c&&!b.drag.moving&&(c._handleEvent("mouseout",a),this.targetShape=null),this.mousePos=undefined,this._endDrag(a)},_mousemove:function(a){this._setUserPosition(a);var b=Kinetic.Global,c=this.getIntersection(this.getUserPosition());if(c){var d=c.shape;d&&(!b.drag.moving&&c.pixel[3]===255&&(!this.targetShape||this.targetShape._id!==d._id)?(this.targetShape&&this.targetShape._handleEvent("mouseout",a,d),d._handleEvent("mouseover",a,this.targetShape),this.targetShape=d):d._handleEvent("mousemove",a))}else this.targetShape&&!b.drag.moving&&(this.targetShape._handleEvent("mouseout",a),this.targetShape=null);this._startDrag(a)},_mousedown:function(a){this._setUserPosition(a);var b=this.getIntersection(this.getUserPosition());if(b&&b.shape){var c=b.shape;this.clickStart=!0,c._handleEvent("mousedown",a)}this.attrs.draggable&&this._initDrag()},_mouseup:function(a){this._setUserPosition(a);var b=Kinetic.Global,c=this.getIntersection(this.getUserPosition()),d=this;if(c&&c.shape){var e=c.shape;e._handleEvent("mouseup",a),this.clickStart&&(!b.drag.moving||!b.drag.node)&&(e._handleEvent("click",a),this.inDoubleClickWindow&&e._handleEvent("dblclick",a),this.inDoubleClickWindow=!0,setTimeout(function(){d.inDoubleClickWindow=!1},this.dblClickWindow))}this.clickStart=!1,this._endDrag(a)},_touchstart:function(a){this._setUserPosition(a),a.preventDefault();var b=this.getIntersection(this.getUserPosition());if(b&&b.shape){var c=b.shape;this.tapStart=!0,c._handleEvent("touchstart",a)}this.attrs.draggable&&this._initDrag()},_touchend:function(a){this._setUserPosition(a);var b=Kinetic.Global,c=this.getIntersection(this.getUserPosition()),d=this;if(c&&c.shape){var e=c.shape;e._handleEvent("touchend",a),this.tapStart&&(!b.drag.moving||!b.drag.node)&&(e._handleEvent("tap",a),this.inDoubleClickWindow&&e._handleEvent("dbltap",a),this.inDoubleClickWindow=!0,setTimeout(function(){d.inDoubleClickWindow=!1},this.dblClickWindow))}this.tapStart=!1,this._endDrag(a)},_touchmove:function(a){this._setUserPosition(a),a.preventDefault();var b=this.getIntersection(this.getUserPosition());if(b&&b.shape){var c=b.shape;c._handleEvent("touchmove",a)}this._startDrag(a)},_setMousePosition:function(a){var b=a.clientX-this._getContentPosition().left,c=a.clientY-this._getContentPosition().top;this.mousePos={x:b,y:c}},_setTouchPosition:function(a){if(a.touches!==undefined&&a.touches.length===1){var b=a.touches[0],c=b.clientX-this._getContentPosition().left,d=b.clientY-this._getContentPosition().top;this.touchPos={x:c,y:d}}},_getContentPosition:function(){var a=this.content.getBoundingClientRect();return{top:a.top,left:a.left}},_endDrag:function(a){var b=Kinetic.Global,c=b.drag.node;c&&(c.nodeType==="Stage"?c.draw():c.getLayer().draw(),b.drag.moving&&(b.drag.moving=!1,c._handleEvent("dragend",a))),b.drag.node=null,this.dragAnim.stop()},_startDrag:function(a){var b=this,c=Kinetic.Global,d=c.drag.node;if(d){var e=b.getUserPosition(),f=d.attrs.dragConstraint,g=d.attrs.dragBounds,h={x:d.attrs.x,y:d.attrs.y},i={x:e.x-c.drag.offset.x,y:e.y-c.drag.offset.y};g.left!==undefined&&i.x<g.left&&(i.x=g.left),g.right!==undefined&&i.x>g.right&&(i.x=g.right),g.top!==undefined&&i.y<g.top&&(i.y=g.top),g.bottom!==undefined&&i.y>g.bottom&&(i.y=g.bottom),d.setAbsolutePosition(i),f==="horizontal"?d.attrs.y=h.y:f==="vertical"&&(d.attrs.x=h.x),c.drag.moving||(c.drag.moving=!0,c.drag.node._handleEvent("dragstart",a)),c.drag.node._handleEvent("dragmove",a)}},_buildDOM:function(){this.content=document.createElement("div"),this.content.style.position="relative",this.content.style.display="inline-block",this.content.className="kineticjs-content",this.attrs.container.appendChild(this.content),this.bufferCanvas=new Kinetic.Canvas({width:this.attrs.width,height:this.attrs.height}),this._resizeDOM()},_addId:function(a){a.attrs.id!==undefined&&(this.ids[a.attrs.id]=a)},_removeId:function(a){a!==undefined&&delete this.ids[a]},_addName:function(a){var b=a.attrs.name;b!==undefined&&(this.names[b]===undefined&&(this.names[b]=[]),this.names[b].push(a))},_removeName:function(a,b){if(a!==undefined){var c=this.names[a];if(c!==undefined){for(var d=0;d<c.length;d++){var e=c[d];e._id===b&&c.splice(d,1)}c.length===0&&delete this.names[a]}}},_onContent:function(a,b){var c=a.split(" ");for(var d=0;d<c.length;d++){var e=c[d];this.content.addEventListener(e,b,!1)}},_setStageDefaultProperties:function(){this.nodeType="Stage",this.dblClickWindow=400,this.targetShape=null,this.mousePos=undefined,this.clickStart=!1,this.touchPos=undefined,this.tapStart=!1,this.ids={},this.names={},this.dragAnim=new Kinetic.Animation}},Kinetic.Global.extend(Kinetic.Stage,Kinetic.Container),Kinetic.Node.addGettersSetters(Kinetic.Stage,["width","height"]),Kinetic.Layer=function(a){this._initLayer(a)},Kinetic.Layer.prototype={_initLayer:function(a){this.setDefaultAttrs({clearBeforeDraw:!0}),this.nodeType="Layer",this.beforeDrawFunc=undefined,this.afterDrawFunc=undefined,this.canvas=new Kinetic.Canvas,this.canvas.getElement().style.position="absolute",this.bufferCanvas=new Kinetic.Canvas,this.bufferCanvas.name="buffer",Kinetic.Container.call(this,a)},draw:function(a){this.beforeDrawFunc!==undefined&&this.beforeDrawFunc.call(this),a?this._draw(a):(this._draw(this.getCanvas()),this._draw(this.bufferCanvas)),this.afterDrawFunc!==undefined&&this.afterDrawFunc.call(this)},drawBuffer:function(){this.draw(this.bufferCanvas)},drawScene:function(){this.draw(this.getCanvas())},beforeDraw:function(a){this.beforeDrawFunc=a},afterDraw:function(a){this.afterDrawFunc=a},getCanvas:function(){return this.canvas},getContext:function(){return this.canvas.context},clear:function(){this.getCanvas().clear()},toDataURL:function(a){var b,c=a&&a.mimeType?a.mimeType:null,d=a&&a.quality?a.quality:null;return a&&a.width&&a.height?b=new Kinetic.Canvas(a.width,a.height):b=this.getCanvas(),b.toDataURL(c,d)},_remove:function(){try{this.getStage().content.removeChild(this.canvas.element)}catch(a){Kinetic.Global.warn("unable to remove layer scene canvas element from the document")}},__draw:function(a){this.attrs.clearBeforeDraw&&a.clear()}},Kinetic.Global.extend(Kinetic.Layer,Kinetic.Container),Kinetic.Node.addGettersSetters(Kinetic.Layer,["clearBeforeDraw"]),Kinetic.Group=function(a){this._initGroup(a)},Kinetic.Group.prototype={_initGroup:function(a){this.nodeType="Group",Kinetic.Container.call(this,a)}},Kinetic.Global.extend(Kinetic.Group,Kinetic.Container),Kinetic.Shape=function(a){this._initShape(a)},Kinetic.Shape.prototype={_initShape:function(a){this.nodeType="Shape",this.appliedShadow=!1;var b=Kinetic.Global.shapes,c;for(;;){c=Kinetic.Type._getRandomColorKey();if(c&&!(c in b))break}this.colorKey=c,b[c]=this,Kinetic.Node.call(this,a)},getContext:function(){return this.getLayer().getContext()},getCanvas:function(){return this.getLayer().getCanvas()},stroke:function(a){var b=this.getStrokeWidth(),c=this.getStroke();if(c||b){var d=Kinetic.Global,e=!1;a.save(),this.attrs.shadow&&!this.appliedShadow&&(e=this._applyShadow(a)),a.lineWidth=b||2,a.strokeStyle=c||"black",a.stroke(a),a.restore(),e&&this.stroke(a)}},fill:function(a){var b=!1,c=this.attrs.fill;if(c){a.save(),this.attrs.shadow&&!this.appliedShadow&&(b=this._applyShadow(a));var d=c.start,e=c.end,f=null;if(Kinetic.Type._isString(c))a.fillStyle=c,a.fill(a);else if(c.image){var g=c.repeat?c.repeat:"repeat";c.scale&&a.scale(c.scale.x,c.scale.y),c.offset&&a.translate(c.offset.x,c.offset.y),a.fillStyle=a.createPattern(c.image,g),a.fill(a)}else if(!d.radius&&!e.radius){var h=a.createLinearGradient(d.x,d.y,e.x,e.y),i=c.colorStops;for(var j=0;j<i.length;j+=2)h.addColorStop(i[j],i[j+1]);a.fillStyle=h,a.fill(a)}else if(!d.radius&&d.radius!==0||!e.radius&&e.radius!==0)a.fillStyle="black",a.fill(a);else{var h=a.createRadialGradient(d.x,d.y,d.radius,e.x,e.y,e.radius),i=c.colorStops;for(var j=0;j<i.length;j+=2)h.addColorStop(i[j],i[j+1]);a.fillStyle=h,a.fill(a)}a.restore()}b&&this.fill(a)},fillText:function(a,b){var c=!1;this.attrs.textFill&&(a.save(),this.attrs.shadow&&!this.appliedShadow&&(c=this._applyShadow(a)),a.fillStyle=this.attrs.textFill,a.fillText(b,0,0),a.restore()),c&&this.fillText(a,b,0,0)},strokeText:function(a,b){var c=!1;if(this.attrs.textStroke||this.attrs.textStrokeWidth){a.save(),this.attrs.shadow&&!this.appliedShadow&&(c=this._applyShadow(a));var d=this.attrs.textStroke?this.attrs.textStroke:"black",e=this.attrs.textStrokeWidth?this.attrs.textStrokeWidth:2;a.lineWidth=e,a.strokeStyle=d,a.strokeText(b,0,0),a.restore()}c&&this.strokeText(a,b,0,0)},drawImage:function(){var a=!1,b=arguments[0];b.save();var c=Array.prototype.slice.call(arguments);if(c.length===6||c.length===10)this.attrs.shadow&&!this.appliedShadow&&(a=this._applyShadow(b)),c.length===6?b.drawImage(c[1],c[2],c[3],c[4],c[5]):b.drawImage(c[1],c[2],c[3],c[4],c[5],c[6],c[7],c[8],c[9]);b.restore(),a&&this.drawImage.apply(this,c)},applyLineJoin:function(a){this.attrs.lineJoin&&(a.lineJoin=this.attrs.lineJoin)},_applyShadow:function(a){var b=this.attrs.shadow;if(b){var c=this.getAbsoluteOpacity(),d=b.color?b.color:"black",e=b.blur?b.blur:5,f=b.offset?b.offset:{x:0,y:0};return b.opacity&&(a.globalAlpha=b.opacity*c),a.shadowColor=d,a.shadowBlur=e,a.shadowOffsetX=f.x,a.shadowOffsetY=f.y,this.appliedShadow=!0,!0}return!1},intersects:function(){var a=Kinetic.Type._getXY(Array.prototype.slice.call(arguments)),b=this.getStage(),c=b.bufferCanvas;c.clear(),this._draw(c);var d=c.context.getImageData(Math.round(a.x),Math.round(a.y),1,1).data;return d[3]>0},_remove:function(){delete Kinetic.Global.shapes[this.colorKey]},__draw:function(a){if(this.attrs.drawFunc){var b=this.getStage(),c=a.getContext(),d=[],e=this.parent;d.unshift(this);while(e)d.unshift(e),e=e.parent;c.save();for(var f=0;f<d.length;f++){var g=d[f],h=g.getTransform(),i=h.getMatrix();c.transform(i[0],i[1],i[2],i[3],i[4],i[5])}var j=this.getAbsoluteOpacity();j!==1&&(c.globalAlpha=j),this.applyLineJoin(c),this.appliedShadow=!1;var k=Kinetic.Global.BUFFER_WHITELIST,l=Kinetic.Global.BUFFER_BLACKLIST,m={};if(a.name==="buffer"){for(var f=0;f<k.length;f++){var n=k[f];m[n]=this.attrs[n];if(this.attrs[n]||n==="fill"&&!this.attrs.stroke&&!("image"in this.attrs))this.attrs[n]="#"+this.colorKey}for(var f=0;f<l.length;f++){var n=l[f];m[n]=this.attrs[n],this.attrs[n]=""}"image"in this.attrs&&(m.image=this.attrs.image,this.imageBuffer?this.attrs.image=this.imageBuffer:(this.attrs.image=null,this.attrs.fill="#"+this.colorKey)),c.globalAlpha=1}this.attrs.drawFunc.call(this,a.getContext());if(a.name==="buffer"){var o=k.concat(l);for(var f=0;f<o.length;f++){var n=o[f];this.attrs[n]=m[n]}this.attrs.image=m.image}c.restore()}}},Kinetic.Global.extend(Kinetic.Shape,Kinetic.Node),Kinetic.Node.addGettersSetters(Kinetic.Shape,["fill","stroke","lineJoin","strokeWidth","shadow","drawFunc","filter"]),Kinetic.Rect=function(a){this._initRect(a)},Kinetic.Rect.prototype={_initRect:function(a){this.setDefaultAttrs({width:0,height:0,cornerRadius:0}),this.shapeType="Rect",a.drawFunc=this.drawFunc,Kinetic.Shape.call(this,a)},drawFunc:function(a){a.beginPath(),this.attrs.cornerRadius===0?a.rect(0,0,this.attrs.width,this.attrs.height):(a.moveTo(this.attrs.cornerRadius,0),a.lineTo(this.attrs.width-this.attrs.cornerRadius,0),a.arc(this.attrs.width-this.attrs.cornerRadius,this.attrs.cornerRadius,this.attrs.cornerRadius,Math.PI*3/2,0,!1),a.lineTo(this.attrs.width,this.attrs.height-this.attrs.cornerRadius),a.arc(this.attrs.width-this.attrs.cornerRadius,this.attrs.height-this.attrs.cornerRadius,this.attrs.cornerRadius,0,Math.PI/2,!1),a.lineTo(this.attrs.cornerRadius,this.attrs.height),a.arc(this.attrs.cornerRadius,this.attrs.height-this.attrs.cornerRadius,this.attrs.cornerRadius,Math.PI/2,Math.PI,!1),a.lineTo(0,this.attrs.cornerRadius),a.arc(this.attrs.cornerRadius,this.attrs.cornerRadius,this.attrs.cornerRadius,Math.PI,Math.PI*3/2,!1)),a.closePath(),this.fill(a),this.stroke(a)},setSize:function(){var a=Kinetic.Type._getSize(Array.prototype.slice.call(arguments));this.setAttrs(a)},getSize:function(){return{width:this.attrs.width,height:this.attrs.height}}},Kinetic.Global.extend(Kinetic.Rect,Kinetic.Shape),Kinetic.Node.addGettersSetters(Kinetic.Rect,["width","height","cornerRadius"]),Kinetic.Circle=function(a){this._initCircle(a)},Kinetic.Circle.prototype={_initCircle:function(a){this.setDefaultAttrs({radius:0}),this.shapeType="Circle",a.drawFunc=this.drawFunc,Kinetic.Shape.call(this,a)},drawFunc:function(a){a.beginPath(),a.arc(0,0,this.getRadius(),0,Math.PI*2,!0),a.closePath(),this.fill(a),this.stroke(a)}},Kinetic.Global.extend(Kinetic.Circle,Kinetic.Shape),Kinetic.Node.addGettersSetters(Kinetic.Circle,["radius"]),Kinetic.Ellipse=function(a){this._initEllipse(a)},Kinetic.Ellipse.prototype={_initEllipse:function(a){this.setDefaultAttrs({radius:{x:0,y:0}}),this.shapeType="Ellipse",a.drawFunc=this.drawFunc,Kinetic.Shape.call(this,a)},drawFunc:function(a){var b=this.getRadius();a.beginPath(),a.save(),b.x!==b.y&&a.scale(1,b.y/b.x),a.arc(0,0,b.x,0,Math.PI*2,!0),a.restore(),a.closePath(),this.fill(a),this.stroke(a)}},Kinetic.Global.extend(Kinetic.Ellipse,Kinetic.Shape),Kinetic.Node.addGettersSetters(Kinetic.Ellipse,["radius"]),Kinetic.Image=function(a){this._initImage(a)},Kinetic.Image.prototype={_initImage:function(a){this.shapeType="Image",a.drawFunc=this.drawFunc,Kinetic.Shape.call(this,a);var b=this;this.on("imageChange",function(a){b._syncSize()}),this._syncSize()},drawFunc:function(a){var b=this.getWidth(),c=this.getHeight();a.beginPath(),a.rect(0,0,b,c),a.closePath(),this.fill(a),this.stroke(a);if(this.attrs.image)if(this.attrs.crop&&this.attrs.crop.width&&this.attrs.crop.height){var d=this.attrs.crop.x?this.attrs.crop.x:0,e=this.attrs.crop.y?this.attrs.crop.y:0,f=this.attrs.crop.width,g=this.attrs.crop.height;this.drawImage(a,this.attrs.image,d,e,f,g,0,0,b,c)}else this.drawImage(a,this.attrs.image,0,0,b,c)},setSize:function(){var a=Kinetic.Type._getSize(Array.prototype.slice.call(arguments));this.setAttrs(a)},getSize:function(){return{width:this.attrs.width,height:this.attrs.height}},applyFilter:function(a){var b=new Kinetic.Canvas(this.attrs.image.width,this.attrs.image.height),c=b.getContext();c.drawImage(this.attrs.image,0,0);try{var d=c.getImageData(0,0,b.getWidth(),b.getHeight());a.filter(d,a);var e=this;Kinetic.Type._getImage(d,function(b){e.setImage(b),a.callback&&a.callback()})}catch(f){Kinetic.Global.warn("Unable to apply filter.")}},createImageBuffer:function(a){var b=new Kinetic.Canvas(this.attrs.width,this.attrs.height),c=b.getContext();c.drawImage(this.attrs.image,0,0);try{var d=c.getImageData(0,0,b.getWidth(),b.getHeight()),e=d.data,f=Kinetic.Type._hexToRgb(this.colorKey);for(var g=0,h=e.length;g<h;g+=4)e[g]=f.r,e[g+1]=f.g,e[g+2]=f.b;var i=this;Kinetic.Type._getImage(d,function(b){i.imageBuffer=b,a&&a()})}catch(j){Kinetic.Global.warn("Unable to create image buffer.")}},clearImageBuffer:function(){delete this.imageBuffer},_syncSize:function(){this.attrs.image&&(this.attrs.width||this.setAttrs({width:this.attrs.image.width}),this.attrs.height||this.setAttrs({height:this.attrs.image.height}))}},Kinetic.Global.extend(Kinetic.Image,Kinetic.Shape),Kinetic.Node.addGettersSetters(Kinetic.Image,["image","crop","filter","width","height"]),Kinetic.Polygon=function(a){this._initPolygon(a)},Kinetic.Polygon.prototype={_initPolygon:function(a){this.setDefaultAttrs({points:[]}),this.shapeType="Polygon",a.drawFunc=this.drawFunc,Kinetic.Shape.call(this,a)},drawFunc:function(a){a.beginPath(),a.moveTo(this.attrs.points[0].x,this.attrs.points[0].y);for(var b=1;b<this.attrs.points.length;b++)a.lineTo(this.attrs.points[b].x,this.attrs.points[b].y);a.closePath(),this.fill(a),this.stroke(a)}},Kinetic.Global.extend(Kinetic.Polygon,Kinetic.Shape),Kinetic.Node.addGettersSetters(Kinetic.Polygon,["points"]),Kinetic.Text=function(a){this._initText(a)},Kinetic.Text.prototype={_initText:function(a){this.setDefaultAttrs({fontFamily:"Calibri",text:"",fontSize:12,align:"left",verticalAlign:"top",fontStyle:"normal",padding:0,width:"auto",height:"auto",detectionType:"path",cornerRadius:0,lineHeight:1.2}),this.dummyCanvas=document.createElement("canvas"),this.shapeType="Text",a.drawFunc=this.drawFunc,Kinetic.Shape.call(this,a);var b=["fontFamily","fontSize","fontStyle","padding","align","lineHeight","text","width","height"],c=this;for(var d=0;d<b.length;d++){var e=b[d];this.on(e+"Change.kinetic",c._setTextData)}c._setTextData()},drawFunc:function(a){a.beginPath();var b=this.getBoxWidth(),c=this.getBoxHeight();this.attrs.cornerRadius===0?a.rect(0,0,b,c):(a.moveTo(this.attrs.cornerRadius,0),a.lineTo(b-this.attrs.cornerRadius,0),a.arc(b-this.attrs.cornerRadius,this.attrs.cornerRadius,this.attrs.cornerRadius,Math.PI*3/2,0,!1),a.lineTo(b,c-this.attrs.cornerRadius),a.arc(b-this.attrs.cornerRadius,c-this.attrs.cornerRadius,this.attrs.cornerRadius,0,Math.PI/2,!1),a.lineTo(this.attrs.cornerRadius,c),a.arc(this.attrs.cornerRadius,c-this.attrs.cornerRadius,this.attrs.cornerRadius,Math.PI/2,Math.PI,!1),a.lineTo(0,this.attrs.cornerRadius),a.arc(this.attrs.cornerRadius,this.attrs.cornerRadius,this.attrs.cornerRadius,Math.PI,Math.PI*3/2,!1)),a.closePath(),this.fill(a),this.stroke(a);var d=this.attrs.padding,e=this.attrs.lineHeight*this.getTextHeight(),f=this.textArr;a.font=this.attrs.fontStyle+" "+this.attrs.fontSize+"pt "+this.attrs.fontFamily,a.textBaseline="middle",a.textAlign="left",a.save(),a.translate(d,0),a.translate(0,d+this.getTextHeight()/2);var g=this.appliedShadow;for(var h=0;h<f.length;h++){var i=f[h];this.appliedShadow=g,a.save(),this.attrs.align==="right"?a.translate(this.getBoxWidth()-this._getTextSize(i).width-d*2,0):this.attrs.align==="center"&&a.translate((this.getBoxWidth()-this._getTextSize(i).width-d*2)/2,0),this.fillText(a,i),this.strokeText(a,i),a.restore(),a.translate(0,e)}a.restore()},getBoxWidth:function(){return this.attrs.width==="auto"?this.getTextWidth()+this.attrs.padding*2:this.attrs.width},getBoxHeight:function(){return this.attrs.height==="auto"?this.getTextHeight()*this.textArr.length*this.attrs.lineHeight+this.attrs.padding*2:this.attrs.height},getTextWidth:function(){return this.textWidth},getTextHeight:function(){return this.textHeight},_getTextSize:function(a){var b=this.dummyCanvas,c=b.getContext("2d");c.save(),c.font=this.attrs.fontStyle+" "+this.attrs.fontSize+"pt "+this.attrs.fontFamily;var d=c.measureText(a);return c.restore(),{width:d.width,height:parseInt(this.attrs.fontSize,10)}},_setTextData:function(){var a=this.attrs.text.split(""),b=[],c=0,d=!0;this.textWidth=0,this.textHeight=this._getTextSize(this.attrs.text).height;var e=this.attrs.lineHeight*this.textHeight;while(a.length>0&&d&&(this.attrs.height==="auto"||e*(c+1)<this.attrs.height-this.attrs.padding*2)){var f=0,g=undefined;d=!1;while(f<a.length){if(a.indexOf("\n")===f){a.splice(f,1),g=a.splice(0,f).join("");break}var h=a.slice(0,f);if(this.attrs.width!=="auto"&&this._getTextSize(h.join("")).width>this.attrs.width-this.attrs.padding*2){if(f==0)break;var i=h.lastIndexOf(" "),j=h.lastIndexOf("-"),k=Math.max(i,j);if(k>=0){g=a.splice(0,1+k).join("");break}g=a.splice(0,f).join("");break}f++,f===a.length&&(g=a.splice(0,f).join(""))}this.textWidth=Math.max(this.textWidth,this._getTextSize(g).width),g!==undefined&&(b.push(g),d=!0),c++}this.textArr=b}},Kinetic.Global.extend(Kinetic.Text,Kinetic.Shape),Kinetic.Node.addGettersSetters(Kinetic.Text,["fontFamily","fontSize","fontStyle","textFill","textStroke","textStrokeWidth","padding","align","lineHeight","text","width","height","cornerRadius","fill","stroke","strokeWidth","shadow"]),Kinetic.Line=function(a){this._initLine(a)},Kinetic.Line.prototype={_initLine:function(a){this.setDefaultAttrs({points:[],lineCap:"butt",dashArray:[],detectionType:"pixel"}),this.shapeType="Line",a.drawFunc=this.drawFunc,Kinetic.Shape.call(this,a)},drawFunc:function(a){var b={};a.beginPath(),a.moveTo(this.attrs.points[0].x,this.attrs.points[0].y);for(var c=1;c<this.attrs.points.length;c++){var d=this.attrs.points[c].x,e=this.attrs.points[c].y;if(this.attrs.dashArray.length>0){var f=this.attrs.points[c-1].x,g=this.attrs.points[c-1].y;this._dashedLine(a,f,g,d,e,this.attrs.dashArray)}else a.lineTo(d,e)}!this.attrs.lineCap||(a.lineCap=this.attrs.lineCap),this.stroke(a)},_dashedLine:function(a,b,c,d,e,f){var g=f.length,h=d-b,i=e-c,j=h>i,k=j?i/h:h/i;k>9999?k=9999:k<-9999&&(k=-9999);var l=Math.sqrt(h*h+i*i),m=0,n=!0;while(l>=.1&&m<1e4){var o=f[m++%g];o===0&&(o=.001),o>l&&(o=l);var p=Math.sqrt(o*o/(1+k*k));j?(b+=h<0&&i<0?p*-1:p,c+=h<0&&i<0?k*p*-1:k*p):(b+=h<0&&i<0?k*p*-1:k*p,c+=h<0&&i<0?p*-1:p),a[n?"lineTo":"moveTo"](b,c),l-=o,n=!n}a.moveTo(d,e)}},Kinetic.Global.extend(Kinetic.Line,Kinetic.Shape),Kinetic.Node.addGettersSetters(Kinetic.Line,["dashArray","lineCap","points"]),Kinetic.Sprite=function(a){this._initSprite(a)},Kinetic.Sprite.prototype={_initSprite:function(a){this.setDefaultAttrs({index:0,frameRate:17}),a.drawFunc=this.drawFunc,Kinetic.Shape.call(this,a),this.anim=new Kinetic.Animation;var b=this;this.on("animationChange.kinetic",function(){b.setIndex(0)})},drawFunc:function(a){var b=this.attrs.animation,c=this.attrs.index,d=this.attrs.animations[b][c];a.beginPath(),a.rect(0,0,d.width,d.height),a.closePath(),this.fill(a),this.stroke(a),this.attrs.image&&(a.beginPath(),a.rect(0,0,d.width,d.height),a.closePath(),this.drawImage(a,this.attrs.image,d.x,d.y,d.width,d.height,0,0,d.width,d.height))},start:function(){var a=this,b=this.getLayer();this.anim.node=b,this.interval=setInterval(function(){var b=a.attrs.index;a._updateIndex(),a.afterFrameFunc&&b===a.afterFrameIndex&&(a.afterFrameFunc(),delete a.afterFrameFunc,delete a.afterFrameIndex)},1e3/this.attrs.frameRate),this.anim.start()},stop:function(){this.anim.stop(),clearInterval(this.interval)},afterFrame:function(a,b){this.afterFrameIndex=a,this.afterFrameFunc=b},_updateIndex:function(){var a=this.attrs.index,b=this.attrs.animation;a<this.attrs.animations[b].length-1?this.attrs.index++:this.attrs.index=0}},Kinetic.Global.extend(Kinetic.Sprite,Kinetic.Shape),Kinetic.Node.addGettersSetters(Kinetic.Sprite,["animation","animations","index"]),Kinetic.Star=function(a){this._initStar(a)},Kinetic.Star.prototype={_initStar:function(a){this.setDefaultAttrs({numPoints:0,innerRadius:0,outerRadius:0}),this.shapeType="Star",a.drawFunc=this.drawFunc,Kinetic.Shape.call(this,a)},drawFunc:function(a){a.beginPath(),a.moveTo(0,0-this.attrs.outerRadius);for(var b=1;b<this.attrs.numPoints*2;b++){var c=b%2===0?this.attrs.outerRadius:this.attrs.innerRadius,d=c*Math.sin(b*Math.PI/this.attrs.numPoints),e=-1*c*Math.cos(b*Math.PI/this.attrs.numPoints);a.lineTo(d,e)}a.closePath(),this.fill(a),this.stroke(a)}},Kinetic.Global.extend(Kinetic.Star,Kinetic.Shape),Kinetic.Node.addGettersSetters(Kinetic.Star,["numPoints","innerRadius","outerRadius"]),Kinetic.RegularPolygon=function(a){this._initRegularPolygon(a)},Kinetic.RegularPolygon.prototype={_initRegularPolygon:function(a){this.setDefaultAttrs({radius:0,sides:0}),this.shapeType="RegularPolygon",a.drawFunc=this.drawFunc,Kinetic.Shape.call(this,a)},drawFunc:function(a){a.beginPath(),a.moveTo(0,0-this.attrs.radius);for(var b=1;b<this.attrs.sides;b++){var c=this.attrs.radius*Math.sin(b*2*Math.PI/this.attrs.sides),d=-1*this.attrs.radius*Math.cos(b*2*Math.PI/this.attrs.sides);a.lineTo(c,d)}a.closePath(),this.fill(a),this.stroke(a)}},Kinetic.Global.extend(Kinetic.RegularPolygon,Kinetic.Shape),Kinetic.Node.addGettersSetters(Kinetic.RegularPolygon,["radius","sides"]),Kinetic.Path=function(a){this._initPath(a)},Kinetic.Path.prototype={_initPath:function(a){this.shapeType="Path",this.dataArray=[];var b=this;a.drawFunc=this.drawFunc,Kinetic.Shape.call(this,a),this.dataArray=Kinetic.Path.parsePathData(this.attrs.data),this.on("dataChange",function(){b.dataArray=Kinetic.Path.parsePathData(b.attrs.data)})},drawFunc:function(a){var b=this.dataArray;a.beginPath();for(var c=0;c<b.length;c++){var d=b[c].command,e=b[c].points;switch(d){case"L":a.lineTo(e[0],e[1]);break;case"M":a.moveTo(e[0],e[1]);break;case"C":a.bezierCurveTo(e[0],e[1],e[2],e[3],e[4],e[5]);break;case"Q":a.quadraticCurveTo(e[0],e[1],e[2],e[3]);break;case"A":var f=e[0],g=e[1],h=e[2],i=e[3],j=e[4],k=e[5],l=e[6],m=e[7],n=h>i?h:i,o=h>i?1:h/i,p=h>i?i/h:1;a.translate(f,g),a.rotate(l),a.scale(o,p),a.arc(0,0,n,j,j+k,1-m),a.scale(1/o,1/p),a.rotate(-l),a.translate(-f,-g);break;case"z":a.closePath()}}this.fill(a),this.stroke(a)}},Kinetic.Global.extend(Kinetic.Path,Kinetic.Shape),Kinetic.Path.getLineLength=function(a,b,c,d){return Math.sqrt((c-a)*(c-a)+(d-b)*(d-b))},Kinetic.Path.getPointOnLine=function(a,b,c,d,e,f,g){f===undefined&&(f=b),g===undefined&&(g=c);var h=(e-c)/(d-b+1e-8),i=Math.sqrt(a*a/(1+h*h)),j=h*i,k;if((g-c)/(f-b+1e-8)===h)k={x:f+i,y:g+j};else{var l,m,n=this.getLineLength(b,c,d,e);if(n<1e-8)return undefined;var o=(f-b)*(d-b)+(g-c)*(e-c);o/=n*n,l=b+o*(d-b),m=c+o*(e-c);var p=this.getLineLength(f,g,l,m),q=Math.sqrt(a*a-p*p);i=Math.sqrt(q*q/(1+h*h)),j=h*i,k={x:l+i,y:m+j}}return k},Kinetic.Path.getPointOnCubicBezier=function(a,b,c,d,e,f,g,h,i){function j(a){return a*a*a}function k(a){return 3*a*a*(1-a)}function l(a){return 3*a*(1-a)*(1-a)}function m(a){return(1-a)*(1-a)*(1-a)}var n=h*j(a)+f*k(a)+d*l(a)+b*m(a),o=i*j(a)+g*k(a)+e*l(a)+c*m(a);return{x:n,y:o}},Kinetic.Path.getPointOnQuadraticBezier=function(a,b,c,d,e,f,g){function h(a){return a*a}function i(a){return 2*a*(1-a)}function j(a){return(1-a)*(1-a)}var k=f*h(a)+d*i(a)+b*j(a),l=g*h(a)+e*i(a)+c*j(a);return{x:k,y:l}},Kinetic.Path.getPointOnEllipticalArc=function(a,b,c,d,e,f){var g=Math.cos(f),h=Math.sin(f),i={x:c*Math.cos(e),y:d*Math.sin(e)};return{x:a+(i.x*g-i.y*h),y:b+(i.x*h+i.y*g)}},Kinetic.Path.parsePathData=function(a){if(!a)return[];var b=a,c=["m","M","l","L","v","V","h","H","z","Z","c","C","q","Q","t","T","s","S","a","A"];b=b.replace(new RegExp(" ","g"),",");for(var d=0;d<c.length;d++)b=b.replace(new RegExp(c[d],"g"),"|"+c[d]);var e=b.split("|"),f=[],g=0,h=0;for(var d=1;d<e.length;d++){var i=e[d],j=i.charAt(0);i=i.slice(1),i=i.replace(new RegExp(",-","g"),"-"),i=i.replace(new RegExp("-","g"),",-"),i=i.replace(new RegExp("e,-","g"),"e-");var k=i.split(",");k.length>0&&k[0]===""&&k.shift();for(var l=0;l<k.length;l++)k[l]=parseFloat(k[l]);while(k.length>0){if(isNaN(k[0]))break;var m=null,n=[],o=g,p=h;switch(j){case"l":g+=k.shift(),h+=k.shift(),m="L",n.push(g,h);break;case"L":g=k.shift(),h=k.shift(),n.push(g,h);break;case"m":g+=k.shift(),h+=k.shift(),m="M",n.push(g,h),j="l";break;case"M":g=k.shift(),h=k.shift(),m="M",n.push(g,h),j="L";break;case"h":g+=k.shift(),m="L",n.push(g,h);break;case"H":g=k.shift(),m="L",n.push(g,h);break;case"v":h+=k.shift(),m="L",n.push(g,h);break;case"V":h=k.shift(),m="L",n.push(g,h);break;case"C":n.push(k.shift(),k.shift(),k.shift(),k.shift()),g=k.shift(),h=k.shift(),n.push(g,h);break;case"c":n.push(g+k.shift(),h+k.shift(),g+k.shift(),h+k.shift()),g+=k.shift(),h+=k.shift(),m="C",n.push(g,h);break;case"S":var q=g,r=h,s=f[f.length-1];s.command==="C"&&(q=g+(g-s.points[2]),r=h+(h-s.points[3])),n.push(q,r,k.shift(),k.shift()),g=k.shift(),h=k.shift(),m="C",n.push(g,h);break;case"s":var q=g,r=h,s=f[f.length-1];s.command==="C"&&(q=g+(g-s.points[2]),r=h+(h-s.points[3])),n.push(q,r,g+k.shift(),h+k.shift()),g+=k.shift(),h+=k.shift(),m="C",n.push(g,h);break;case"Q":n.push(k.shift(),k.shift()),g=k.shift(),h=k.shift(),n.push(g,h);break;case"q":n.push(g+k.shift(),h+k.shift()),g+=k.shift(),h+=k.shift(),m="Q",n.push(g,h);break;case"T":var q=g,r=h,s=f[f.length-1];s.command==="Q"&&(q=g+(g-s.points[0]),r=h+(h-s.points[1])),g=k.shift(),h=k.shift(),m="Q",n.push(q,r,g,h);break;case"t":var q=g,r=h,s=f[f.length-1];s.command==="Q"&&(q=g+(g-s.points[0]),r=h+(h-s.points[1])),g+=k.shift(),h+=k.shift(),m="Q",n.push(q,r,g,h);break;case"A":var t=k.shift(),u=k.shift(),v=k.shift(),w=k.shift(),x=k.shift(),y=g,z=h;g=k.shift(),h=k.shift(),m="A",n=this.convertEndpointToCenterParameterization(y,z,g,h,w,x,t,u,v);break;case"a":var t=k.shift(),u=k.shift(),v=k.shift(),w=k.shift(),x=k.shift(),y=g,z=h;g+=k.shift(),h+=k.shift(),m="A",n=this.convertEndpointToCenterParameterization(y,z,g,h,w,x,t,u,v)}f.push({command:m||j,points:n,start:{x:o,y:p},pathLength:this.calcLength(o,p,m||j,n)})}(j==="z"||j==="Z")&&f.push({command:"z",points:[],start:undefined,pathLength:0})}return f},Kinetic.Path.calcLength=function(a,b,c,d){var e,f,g,h=Kinetic.Path;switch(c){case"L":return h.getLineLength(a,b,d[0],d[1]);case"C":e=0,f=h.getPointOnCubicBezier(0,a,b,d[0],d[1],d[2],d[3],d[4],d[5]);for(t=.01;t<=1;t+=.01)g=h.getPointOnCubicBezier(t,a,b,d[0],d[1],d[2],d[3],d[4],d[5]),e+=h.getLineLength(f.x,f.y,g.x,g.y),f=g;return e;case"Q":e=0,f=h.getPointOnQuadraticBezier(0,a,b,d[0],d[1],d[2],d[3]);for(t=.01;t<=1;t+=.01)g=h.getPointOnQuadraticBezier(t,a,b,d[0],d[1],d[2],d[3]),e+=h.getLineLength(f.x,f.y,g.x,g.y),f=g;return e;case"A":e=0;var i=d[4],j=d[5],k=d[4]+j,l=Math.PI/180;Math.abs(i-k)<l&&(l=Math.abs(i-k)),f=h.getPointOnEllipticalArc(d[0],d[1],d[2],d[3],i,0);if(j<0)for(t=i-l;t>k;t-=l)g=h.getPointOnEllipticalArc(d[0],d[1],d[2],d[3],t,0),e+=h.getLineLength(f.x,f.y,g.x,g.y),f=g;else for(t=i+l;t<k;t+=l)g=h.getPointOnEllipticalArc(d[0],d[1],d[2],d[3],t,0),e+=h.getLineLength(f.x,f.y,g.x,g.y),f=g;return g=h.getPointOnEllipticalArc(d[0],d[1],d[2],d[3],k,0),e+=h.getLineLength(f.x,f.y,g.x,g.y),e}return 0},Kinetic.Path.convertEndpointToCenterParameterization=function(a,b,c,d,e,f,g,h,i){var j=i*(Math.PI/180),k=Math.cos(j)*(a-c)/2+Math.sin(j)*(b-d)/2,l=-1*Math.sin(j)*(a-c)/2+Math.cos(j)*(b-d)/2,m=k*k/(g*g)+l*l/(h*h);m>1&&(g*=Math.sqrt(m),h*=Math.sqrt(m));var n=Math.sqrt((g*g*h*h-g*g*l*l-h*h*k*k)/(g*g*l*l+h*h*k*k));e==f&&(n*=-1),isNaN(n)&&(n=0);var o=n*g*l/h,p=n*-h*k/g,q=(a+c)/2+Math.cos(j)*o-Math.sin(j)*p,r=(b+d)/2+Math.sin(j)*o+Math.cos(j)*p,s=function(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1])},t=function(a,b){return(a[0]*b[0]+a[1]*b[1])/(s(a)*s(b))},u=function(a,b){return(a[0]*b[1]<a[1]*b[0]?-1:1)*Math.acos(t(a,b))},v=u([1,0],[(k-o)/g,(l-p)/h]),w=[(k-o)/g,(l-p)/h],x=[(-1*k-o)/g,(-1*l-p)/h],y=u(w,x);return t(w,x)<=-1&&(y=Math.PI),t(w,x)>=1&&(y=0),f===0&&y>0&&(y-=2*Math.PI),f==1&&y<0&&(y+=2*Math.PI),[q,r,g,h,v,y,j,f]},Kinetic.Node.addGettersSetters(Kinetic.Path,["data"]),Kinetic.TextPath=function(a){this._initTextPath(a)},Kinetic.TextPath.prototype={_initTextPath:function(a){this.setDefaultAttrs({fontFamily:"Calibri",fontSize:12,fontStyle:"normal",detectionType:"path",text:""}),this.dummyCanvas=document.createElement("canvas"),this.shapeType="TextPath",this.dataArray=[];var b=this;a.drawFunc=this.drawFunc,Kinetic.Shape.call(this,a),this.dataArray=Kinetic.Path.parsePathData(this.attrs.data),this.on("dataChange",function(){b.dataArray=Kinetic.Path.parsePathData(this.attrs.data)});var c=["text","textStroke","textStrokeWidth"];for(var d=0;d<c.length;d++){var e=c[d];this.on(e+"Change",b._setTextData)}b._setTextData()},drawFunc:function(a){var b=this.charArr;a.font=this.attrs.fontStyle+" "+this.attrs.fontSize+"pt "+this.attrs.fontFamily,a.textBaseline="middle",a.textAlign="left",a.save();var c=this.glyphInfo;for(var d=0;d<c.length;d++){a.save();var e=c[d].p0,f=c[d].p1,g=parseFloat(this.attrs.fontSize);a.translate(e.x,e.y),a.rotate(c[d].rotation),this.fillText(a,c[d].text),this.strokeText(a,c[d].text),a.restore()}a.restore()},getTextWidth:function(){return this.textWidth},getTextHeight:function(){return this.textHeight},_getTextSize:function(a){var b=this.dummyCanvas,c=b.getContext("2d");c.save(),c.font=this.attrs.fontStyle+" "+this.attrs.fontSize+"pt "+this.attrs.fontFamily;var d=c.measureText(a);return c.restore(),{width:d.width,height:parseInt(this.attrs.fontSize,10)}},_setTextData:function(){var a=this,b=this._getTextSize(this.attrs.text);this.textWidth=b.width,this.textHeight=b.height,this.glyphInfo=[];var c=this.attrs.text.split(""),d,e,f,g=-1,h=0,i=function(){h=0;var b=a.dataArray;for(var c=g+1;c<b.length;c++){if(b[c].pathLength>0)return g=c,b[c];b[c].command=="M"&&(d={x:b[c].points[0],y:b[c].points[1]})}return{}},j=function(b,c){var g=a._getTextSize(b).width,j=0,k=0,l=!1;e=undefined;while(Math.abs(g-j)/g>.01&&k<25){k++;var m=j;while(f===undefined)f=i(),f&&m+f.pathLength<g&&(m+=f.pathLength,f=undefined);if(f==={}||d===undefined)return undefined;var n=!1;switch(f.command){case"L":Kinetic.Path.getLineLength(d.x,d.y,f.points[0],f.points[1])>g?e=Kinetic.Path.getPointOnLine(g,d.x,d.y,f.points[0],f.points[1],d.x,d.y):f=undefined;break;case"A":var o=f.points[4],p=f.points[5],q=f.points[4]+p;h===0?h=o+1e-8:g>j?h+=Math.PI/180*p/Math.abs(p):h-=Math.PI/360*p/Math.abs(p),Math.abs(h)>Math.abs(q)&&(h=q,n=!0),e=Kinetic.Path.getPointOnEllipticalArc(f.points[0],f.points[1],f.points[2],f.points[3],h,f.points[6]);break;case"C":h===0?g>f.pathLength?h=1e-8:h=g/f.pathLength:g>j?h+=(g-j)/f.pathLength:h-=(j-g)/f.pathLength,h>1&&(h=1,n=!0),e=Kinetic.Path.getPointOnCubicBezier(h,f.start.x,f.start.y,f.points[0],f.points[1],f.points[2],f.points[3],f.points[4],f.points[5]);break;case"Q":h===0?h=g/f.pathLength:g>j?h+=(g-j)/f.pathLength:h-=(j-g)/f.pathLength,h>1&&(h=1,n=!0),e=Kinetic.Path.getPointOnQuadraticBezier(h,f.start.x,f.start.y,f.points[0],f.points[1],f.points[2],f.points[3])}e!==undefined&&(j=Kinetic.Path.getLineLength(d.x,d.y,e.x,e.y)),n&&(n=!1,f=undefined)}};for(var k=0;k<c.length;k++){j(c[k]);if(d===undefined||e===undefined)break;var l=Kinetic.Path.getLineLength(d.x,d.y,e.x,e.y),m=0,n=Kinetic.Path.getPointOnLine(m+l/2,d.x,d.y,e.x,e.y),o=Math.atan2(e.y-d.y,e.x-d.x);this.glyphInfo.push({transposeX:n.x,transposeY:n.y,text:c[k],rotation:o,p0:d,p1:e}),d=e}}},Kinetic.Global.extend(Kinetic.TextPath,Kinetic.Shape),Kinetic.Node.addGettersSetters(Kinetic.TextPath,["fontFamily","fontSize","fontStyle","textFill","textStroke","textStrokeWidth","text"]);var stage;var backgroundLayer;var characterLayer;var textLayer;var secondTextLayer;var hudLayer;var background;var popUpLayer;var version="Game v10000 ,QJS integrated";var debug=0;var question_OS;var levelSave;var roaming=0;var timeCount=0;var score=new Array;score[1]=0;score[2]=0;score[3]=0;score[4]=0;var allProgress=0;var progress=new Array;progress[1]=0;progress[2]=0;progress[3]=0;progress[4]=0;var played=new Array;played[1]=0;played[2]=0;played[3]=0;played[4]=0;var lastPlayed=0;var goodInLevel=new Array;goodInLevel[1]=0;goodInLevel[2]=0;goodInLevel[3]=0;goodInLevel[4]=0;var allGood=0;var inLevel=0;var questNumber=0;var levelFinal=0;var statusLevel=new Array;statusLevel[1]=1;statusLevel[2]=2;statusLevel[3]=2;statusLevel[4]=2;var goodQuestsL1=new Array;var goodQuestsL2=new Array;var goodQuestsL3=new Array;var goodQuestsL4=new Array;var goodQuestsL5=new Array;var answer1;var answer2;var answer3;var answer4;var answerGood;var answerArray=new Array;var randomOut;var popupActive=0;var a_X1;var a_Y1;var a_X2;var a_Y2;var credits_MainText;var s_SelectText;var s_GoodText;var s_ScoreText;var s_HText;var s_bckText;var s_MainText;var m_MainText;var myQuestion1=new Array;var myQuestion2=new Array;var myQuestion3=new Array;var myQuestion4=new Array;var myQuestion5=new Array;myAnswer1=new Array;myAnswer2=new Array;myAnswer3=new Array;myAnswer4=new Array;myAnswer5=new Array;myQuestion1[1]="Wanneer werd de Eindhovense school, het Sint Lucas eindhoven?";myQuestion1[2]="Is Teamwork (onder klasgenoten) vereist binnen deze opleiding?";myQuestion1[3]="Mag je drinken in de lokalen";myQuestion1[4]="Welke richting binnen de school wordt als belangrijkste beschouwd, programmeren of art?";myQuestion1[5]="Hoelaat beginnen de lessen?";myQuestion1[6]="Waar staan de 3 P's voor binnen het beleid van de opleiding?";myQuestion1[7]="Wordt er bij de ontwikkeling van een game eerst aan de art of eerst aan het programmeren gewerkt?";myQuestion1[8]="Hoeveel specialisaties zijn er binnen de artist richting?";myQuestion1[9]="In welk schooljaar zal de leerling zich gaan specialiseren in ofwel art, of programmeren?";myQuestion1[10]="Welk van de volgende programma's wordt er gebruik bij de 3D vakken?";myQuestion1[11]="Mag je muziek aan in de klas?";myQuestion1[12]="Mag je eten in de klas?";myQuestion1[13]="Wat is een concept?";myQuestion1[14]="De kleuren van Sint Lucas zijn?";myQuestion1[15]="Kan je op school printen?";myAnswer1[1]="2009^2010^2011^2012^4";myAnswer1[2]="Ja^Nee^Een beetje^-^1";myAnswer1[3]="Ja^Nee^Ja, alleen als het flesje weer gesloten kan worden^Nee, drinken is verboden met laptops in het lokaal^3";myAnswer1[4]="programmeren^art^Beide richtingen^geen van allen^3";myAnswer1[5]="08:30^08:45^08:50^09:00^4";myAnswer1[6]="Passie, plezier & programmeren^Passie, plezier & professionaliteit^perfectie, participatie & plezier^plezier, perfectie & professionaliteit^2";myAnswer1[7]="Geen van beide, eerst het concept^Direct aan beide^Eerst het programmeren^Eerst de art^1";myAnswer1[8]="geen^1^2^3^3";myAnswer1[9]="in het eerste schooljaar^in het derde schooljaar^in de 2e helft van het 2e schooljaar^in het tweede schooljaar^4";myAnswer1[10]="3D's Max^Z Brush^Maya^Google Sketsh-up^1";myAnswer1[11]="Ja^Nee^-^-^1";myAnswer1[12]="Ja, alles^Ja, alleen koekjes^Nee, helemaal niets^-^3";myAnswer1[13]="een afbeelding^Uitwerking van ideeen voor de game^Muziek^Schets over de game^2";myAnswer1[14]="Groen blauw^Rood wit^Zwart Oranje^Wit Oranje^3";myAnswer1[15]="Ja^Nee^-^-^1";myQuestion2[1]="De naam van de opleiding is?";myQuestion2[2]="Wordt er bij de ontwikkeling van een game eerst aan de art of eerst aan het programmeren gewerkt?";myQuestion2[3]="Binnen het beleid wordt er van de leerlingen verwacht dat ze professioneel handelen bij bijv. ziekteverzuim";myQuestion2[4]="De school heet nu Sint Lucas, maar hoe heette de school voorheen?";myQuestion2[5]="Om te wennen aan het werken in de industrie wordt er op school ook gewerkt in teamverband, hoe wordt dit gedaan?";myQuestion2[6]="Uit hoeveel klassen bestaat de opleiding?";myQuestion2[7]="Van uit het Sint Lucas MBO kan de leerling doorstromen naar welke HBO studie?";myQuestion2[8]="Het Sint Lucas heeft nog een 2e dependance in welke stad?";myQuestion2[9]="Welk van de volgende programma's wordt er gebruikt bij de 2D vakken?";myQuestion2[10]="Luc Peersman is leraar?";myQuestion2[11]="Een ander woord voor game-art is?";myQuestion2[12]="De gamesetting geeft wat weer?";myQuestion2[13]="Op wat voor een MBO niveau studeer je als leerling van het Sint Lucas Game art and -development?";myQuestion2[14]="Het gemiddelde startersloon van een game-designer is ?";myQuestion2[15]="Waar staan de 3 p's voor binnen het beleid van de opleiding?";myAnswer2[1]="Art and development studies^Game design^Game development^Game art and -development^4";myAnswer2[2]="Eerst het programmeren^Eerst de art^Direct aan beide^Geen van beide eerst het concept^4";myAnswer2[3]="Ja^Nee^-^-^1";myAnswer2[4]="Creatief College Eindhoven^De Eindhovense School^Design Accademie Eindhoven^Von Flotow College^2";myAnswer2[5]="binnen een les  'samenwerken'^d.m.v. samenwerkingstrainingen^Door groepsprojecten te maken^-^3";myAnswer2[6]="1^2^3^4^2";myAnswer2[7]="HKU - Utrecht^NATV - Breda^Beide^Geen van Beide^3";myAnswer2[8]="Helmond^Tilburg^Liempe^Boxtel^4";myAnswer2[9]="MS Paint^Bamboo Sketch^Adobe Photoshop^-^3";myAnswer2[10]="Programmeren^L&B^Pakket^-^1";myAnswer2[11]="Developmental art^Concept art^Industrial-art^-^2";myAnswer2[12]="Hoe de wereld van de game er uit ziet^Hoe de personages er uit zien^2D of 3D^-^3";myAnswer2[13]="niveau 1^niveau 2^niveau 3^niveau 4^4";myAnswer2[14]="1200-1250 euro p.m.^1400 - 1450 euro p.m.^1500-1600 euro p.m.^1800-2000 euro p.m.^2";myAnswer2[15]="plezier, perfectie & professionaliteit^perfectie, participatie & plezier^Passie, plezier & programmeren^Passie, plezier & professionaliteit^4";myQuestion3[1]="Hoeveel uur wordt er aan sport besteed per week?";myQuestion3[2]="Een artist kan werkzaam zijn bij welk van de volgende bedrijven?";myQuestion3[3]="Hoe leveren wij over het algemeen onze projecten en opdrachten in?";myQuestion3[4]="De lessen binnen de opleiding duren nooit langer dan 2 uur.";myQuestion3[5]="De school bestaat uit een MBO en VMBO onderdeel";myQuestion3[6]="In welk schooljaar zal de leerling zich gaan specialiseren in ofwel art, of programmeren?";myQuestion3[7]="In verband van een ontruiming als resultaat van een brandmelding dient de leerling?";myQuestion3[8]="Wordt er bij de ontwikkeling van een game eerst aan de art of eerst aan het programmeren gewerkt?";myQuestion3[9]="Waar stelt iedereen binnen het Sint Lucas veel waarde aan?";myQuestion3[10]="Welke taal is vooral belangrijk binnen de game industrie?";myQuestion3[11]="Renee van Dijck is leraar?";myQuestion3[12]="Wat komt er aan de orde binnen het vak 'Pakket'?";myQuestion3[13]="Welk van de volgende programma's wordt er gebruik bij de 3D vakken?";myQuestion3[14]="Wat is het OSB?";myQuestion3[15]="Hoeveel specialisaties zijn er binnen de artist richting?";myAnswer3[1]="een uur^twee uur ^ drie uur^ vier uur^1";myAnswer3[2]="Art bureau^Willekeurig Game-bedrijf^Beide Antwoorden^-^3";myAnswer3[3]="Op papier^Electronisch^Laten zien aan de docent^Niet^2";myAnswer3[4]="Ja^Nee^-^-^2";myAnswer3[5]="Ja^Nee^-^-^1";myAnswer3[6]="in het eerste schooljaar^in het tweede schooljaar^in de 2e helft van het 2e schooljaar^in het derde schooljaar^2";myAnswer3[7]="Zijn spullen mee te nemen^Zijn spullen te laten staan^-^-^2";myAnswer3[8]="Eerst het programmeren^Eerst de art^Direct aan beide^Geen van beide eerst het concept^4";myAnswer3[9]="Handgebaren taal kennen^Op alle social Media actief zijn^Afspraken nakomen^-^3";myAnswer3[10]="Nederlands^Engels^Frans^Duits^2";myAnswer3[11]="Wiskunde^Engels^Pakket^3D^4";myAnswer3[12]="Werken met het Adobe pakket^Werken met het 3d programma pakket^Werken met teken pakketten^-^1";myAnswer3[13]="3D's Max^Z Brush^Maya^Google Sketch-up^1";myAnswer3[14]="Onderwijs Studie Beurs^Onderwijs Studenten Bar^Onderwijs studenten Bank^Onderwijs Studenten Balie^4";myAnswer3[15]="3^2^1^-^2";myQuestion4[1]="Robin Hilt is leraar?";myQuestion4[2]="Docenten communiceren hoofdzakelijk met de leerlingen via?";myQuestion4[3]="In het werkveld is niet alleen creatief vermogen een vereiste maar ook..?";myQuestion4[4]="welk jaar gaan we op stage?";myQuestion4[5]="Hebben we pauze op vaste tijden?";myQuestion4[6]="Welke taal vakken er worden gegeven?";myQuestion4[7]="heeft Sint lucas een electronische leeromgeving?";myQuestion4[8]="Binnen de opleiding wordt alleen gericht op de vaardigheden benodigd voor het maken van een videospel, maar niet op het werken binnen de industrie.";myQuestion4[9]="Welke electronische leer omgeving gebruiken wij?";myQuestion4[10]="wat wordt er gedaan aan het einde van een project?";myQuestion4[11]="Wat is een 'sprite'?";myQuestion4[12]="Voor hoeveel vakken wordt er gebruik gemaakt van boeken?";myQuestion4[13]="Wat zijn 'assets' ?";myQuestion4[14]="Wat is een HUD?";myQuestion4[15]="Welk van de volgende buslijnen gaat richting het Sint Lucas Eindhoven?";myAnswer4[1]="Art, Design & Vormgeven^Art^Design^Vormgeving^1";myAnswer4[2]="E-mail^Telefoon^-^-^1";myAnswer4[3]="Planmatig kunnen werken^Sociaal vermogen^Beide Antwoorden^-^1";myAnswer4[4]="Leerjaar 1^Leerjaar 2^Leerjaar 3^Leerjaar 4^2";myAnswer4[5]="Ja^Nee^-^-^2";myAnswer4[6]="Nederlands, Engels, Frans^Engels, Nederlands^Frans, Engels^-^2";myAnswer4[7]="Ja^Nee^-^-^1";myAnswer4[8]="Goed^Fout^-^-^2";myAnswer4[9]="ThreeShips N@TSchool^Magister^-^-^2";myAnswer4[10]="Achterover gehangen^Geevalueerd hoe het project gelopen is^direct aan een nieuw project beginnen^-^2";myAnswer4[11]="Een niet bewegend ondeerdeel v.d. game^bewegend onderdeel v.d. game^-^-^2";myAnswer4[12]="2 vakken^4 vakken^ 5 vakken^6 vakken^1";myAnswer4[13]="Foto's^Muziek^Stilstaande plaatjes^Bewegende plaatjes^3";myAnswer4[14]="Hover Up Deamon^Hover Under Deamon^Heads Up Display^Heads Under Display^3";myAnswer4[15]="Buslijn 15^Buslijn 11^Buslijn 401^Buslijn 1^1";finalQuestion=new Array;finalQuestion[1]="Wat is Rekenblokken?";finalQuestion[2]="Welk programma gebruiken wij om foto's te bewerken?";finalQuestion[3]="Wat is de verhouding artists tot developers?";finalQuestion[4]="Javascript is een?";finalQuestion[5]="Wat betekent SLBer";finalAnswer=new Array;finalAnswer[11]="Blokken die iedereen gekregen heeft om te bouwen";finalAnswer[12]="Uitleg hoe plus sommen moeten";finalAnswer[13]="Je personlijke voortgang";finalAnswer[14]="Digitale les methode";finalAnswer[15]="4";finalAnswer[21]="Adobe Photoshop";finalAnswer[22]="SAI";finalAnswer[23]="MS Paint";finalAnswer[24]="Coral painter";finalAnswer[25]="1";finalAnswer[31]="Meer artists dan developers";finalAnswer[32]="meer developers dan artists";finalAnswer[33]="gelijke verhouding";finalAnswer[34]="altijd verschillend";finalAnswer[35]="1";finalAnswer[41]="Programmeer taal";finalAnswer[42]="Communicatie middel";finalAnswer[43]="Social media";finalAnswer[44]="Les methode";finalAnswer[45]="1";finalAnswer[51]="standaart loop baan";finalAnswer[52]="Lang studeer boete";finalAnswer[53]="studie loopbaan brigadier";finalAnswer[54]="Studie loopbaan begeleider";finalAnswer[55]="4";achievementText=new Array;achievementText[1]="Alle levels uitgespeeld";achievementText[2]="volg de tutorial";var leraren;var rect;var timeLeft;var circle1;var circle2;var circle3;var circle4;var circle5;var hudElement;var background;var teacher;var timerLevel=new Array;var m_FText;var a_MainText;var b_MainText;var c_MainText;var d_MainText;var tText;var fText1;var fText2;var roamImg;var north;var south;var west;var east;var northText;var southText;var westText;var eastText;var welkomImg;var skip=0